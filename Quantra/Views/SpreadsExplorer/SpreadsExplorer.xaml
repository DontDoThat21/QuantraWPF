<UserControl x:Class="Quantra.Controls.SpreadsExplorer"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
             xmlns:lvc="clr-namespace:LiveCharts.Wpf;assembly=LiveCharts.Wpf"
             mc:Ignorable="d" 
             d:DesignHeight="800" d:DesignWidth="1200"
             Background="{StaticResource DarkBlueBrush}">
    
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <!-- Header -->
        <materialDesign:Card Grid.Row="0" Background="#262638" Margin="10,10,10,5" Padding="15">
            <StackPanel>
                <TextBlock Text="SPREADS EXPLORER" 
                          FontWeight="Bold" 
                          FontSize="18" 
                          Foreground="#1E90FF" 
                          HorizontalAlignment="Center"/>
                <TextBlock Text="Configure and analyze multi-leg option spread strategies" 
                          FontSize="12" 
                          Foreground="LightGray" 
                          HorizontalAlignment="Center" 
                          Margin="0,5,0,0"/>
            </StackPanel>
        </materialDesign:Card>

        <!-- Main Content -->
        <Grid Grid.Row="1">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="400"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>

            <!-- Left Panel - Configuration -->
            <ScrollViewer Grid.Column="0" VerticalScrollBarVisibility="Auto">
                <StackPanel Margin="10,5,5,10">
                    
                    <!-- Spread Type Selection -->
                    <materialDesign:Card Background="#262638" Margin="0,0,0,10" Padding="15">
                        <StackPanel>
                            <TextBlock Text="SPREAD STRATEGY" FontWeight="Bold" Foreground="#1E90FF" Margin="0,0,0,10"/>
                            <ComboBox x:Name="SpreadTypeComboBox" 
                                     Style="{StaticResource EnhancedComboBoxStyle}"
                                     materialDesign:HintAssist.Hint="Select Spread Type"
                                     SelectionChanged="SpreadTypeComboBox_SelectionChanged">
                                <ComboBoxItem Content="Bull Call Spread" Tag="VerticalSpread">
                                    <ComboBoxItem.ToolTip>
                                        <ToolTip Style="{StaticResource EnhancedToolTipStyle}" MaxWidth="350">
                                            <StackPanel>
                                                <TextBlock Text="Bull Call Spread" FontWeight="Bold" Foreground="#1E90FF" Margin="0,0,0,5"/>
                                                <TextBlock TextWrapping="Wrap" Text="A bullish strategy using two call options with different strike prices. Buy a lower strike call and sell a higher strike call. Limited profit potential with limited risk."/>
                                            </StackPanel>
                                        </ToolTip>
                                    </ComboBoxItem.ToolTip>
                                </ComboBoxItem>
                                <ComboBoxItem Content="Bear Put Spread" Tag="VerticalSpread">
                                    <ComboBoxItem.ToolTip>
                                        <ToolTip Style="{StaticResource EnhancedToolTipStyle}" MaxWidth="350">
                                            <StackPanel>
                                                <TextBlock Text="Bear Put Spread" FontWeight="Bold" Foreground="#1E90FF" Margin="0,0,0,5"/>
                                                <TextBlock TextWrapping="Wrap" Text="A bearish strategy using two put options with different strike prices. Buy a higher strike put and sell a lower strike put. Limited profit potential with limited risk."/>
                                            </StackPanel>
                                        </ToolTip>
                                    </ComboBoxItem.ToolTip>
                                </ComboBoxItem>
                                <ComboBoxItem Content="Long Straddle" Tag="Straddle">
                                    <ComboBoxItem.ToolTip>
                                        <ToolTip Style="{StaticResource EnhancedToolTipStyle}" MaxWidth="350">
                                            <StackPanel>
                                                <TextBlock Text="Long Straddle" FontWeight="Bold" Foreground="#1E90FF" Margin="0,0,0,5"/>
                                                <TextBlock TextWrapping="Wrap" Text="A volatility strategy involving buying both a call and put at the same strike price. Profits from large price movements in either direction. Unlimited profit potential with limited risk."/>
                                            </StackPanel>
                                        </ToolTip>
                                    </ComboBoxItem.ToolTip>
                                </ComboBoxItem>
                                <ComboBoxItem Content="Short Straddle" Tag="Straddle">
                                    <ComboBoxItem.ToolTip>
                                        <ToolTip Style="{StaticResource EnhancedToolTipStyle}" MaxWidth="350">
                                            <StackPanel>
                                                <TextBlock Text="Short Straddle" FontWeight="Bold" Foreground="#1E90FF" Margin="0,0,0,5"/>
                                                <TextBlock TextWrapping="Wrap" Text="A low volatility strategy involving selling both a call and put at the same strike price. Profits when the stock price remains near the strike price. Limited profit with unlimited risk."/>
                                            </StackPanel>
                                        </ToolTip>
                                    </ComboBoxItem.ToolTip>
                                </ComboBoxItem>
                                <ComboBoxItem Content="Long Strangle" Tag="Strangle">
                                    <ComboBoxItem.ToolTip>
                                        <ToolTip Style="{StaticResource EnhancedToolTipStyle}" MaxWidth="350">
                                            <StackPanel>
                                                <TextBlock Text="Long Strangle" FontWeight="Bold" Foreground="#1E90FF" Margin="0,0,0,5"/>
                                                <TextBlock TextWrapping="Wrap" Text="A volatility strategy using calls and puts at different strike prices. Buy an out-of-the-money call and an out-of-the-money put. Profits from large price movements with lower cost than straddle."/>
                                            </StackPanel>
                                        </ToolTip>
                                    </ComboBoxItem.ToolTip>
                                </ComboBoxItem>
                                <ComboBoxItem Content="Short Strangle" Tag="Strangle">
                                    <ComboBoxItem.ToolTip>
                                        <ToolTip Style="{StaticResource EnhancedToolTipStyle}" MaxWidth="350">
                                            <StackPanel>
                                                <TextBlock Text="Short Strangle" FontWeight="Bold" Foreground="#1E90FF" Margin="0,0,0,5"/>
                                                <TextBlock TextWrapping="Wrap" Text="A low volatility strategy selling calls and puts at different strike prices. Sell an out-of-the-money call and an out-of-the-money put. Profits when stock price stays between strike prices."/>
                                            </StackPanel>
                                        </ToolTip>
                                    </ComboBoxItem.ToolTip>
                                </ComboBoxItem>
                                <ComboBoxItem Content="Iron Condor" Tag="IronCondor">
                                    <ComboBoxItem.ToolTip>
                                        <ToolTip Style="{StaticResource EnhancedToolTipStyle}" MaxWidth="350">
                                            <StackPanel>
                                                <TextBlock Text="Iron Condor" FontWeight="Bold" Foreground="#1E90FF" Margin="0,0,0,5"/>
                                                <TextBlock TextWrapping="Wrap" Text="A neutral strategy combining a bull put spread and bear call spread. Profits when the stock price remains within a specific range. Limited profit and limited risk with four option legs."/>
                                            </StackPanel>
                                        </ToolTip>
                                    </ComboBoxItem.ToolTip>
                                </ComboBoxItem>
                                <ComboBoxItem Content="Butterfly Spread" Tag="ButterflySpread">
                                    <ComboBoxItem.ToolTip>
                                        <ToolTip Style="{StaticResource EnhancedToolTipStyle}" MaxWidth="350">
                                            <StackPanel>
                                                <TextBlock Text="Butterfly Spread" FontWeight="Bold" Foreground="#1E90FF" Margin="0,0,0,5"/>
                                                <TextBlock TextWrapping="Wrap" Text="A neutral strategy using three strike prices in a 1:2:1 ratio. Profits when the stock price stays near the middle strike price. Limited profit and limited risk with low cost."/>
                                            </StackPanel>
                                        </ToolTip>
                                    </ComboBoxItem.ToolTip>
                                </ComboBoxItem>
                                <ComboBoxItem Content="Calendar Spread" Tag="CalendarSpread">
                                    <ComboBoxItem.ToolTip>
                                        <ToolTip Style="{StaticResource EnhancedToolTipStyle}" MaxWidth="350">
                                            <StackPanel>
                                                <TextBlock Text="Calendar Spread" FontWeight="Bold" Foreground="#1E90FF" Margin="0,0,0,5"/>
                                                <TextBlock TextWrapping="Wrap" Text="A time decay strategy using options with the same strike but different expirations. Sell a near-term option and buy a longer-term option. Profits from time decay and volatility differences."/>
                                            </StackPanel>
                                        </ToolTip>
                                    </ComboBoxItem.ToolTip>
                                </ComboBoxItem>
                                <ComboBoxItem Content="Covered Call" Tag="CoveredCall">
                                    <ComboBoxItem.ToolTip>
                                        <ToolTip Style="{StaticResource EnhancedToolTipStyle}" MaxWidth="350">
                                            <StackPanel>
                                                <TextBlock Text="Covered Call" FontWeight="Bold" Foreground="#1E90FF" Margin="0,0,0,5"/>
                                                <TextBlock TextWrapping="Wrap" Text="A conservative income strategy involving owning stock and selling call options. Generates additional income from option premiums. Limited upside potential but provides downside protection."/>
                                            </StackPanel>
                                        </ToolTip>
                                    </ComboBoxItem.ToolTip>
                                </ComboBoxItem>
                            </ComboBox>
                        </StackPanel>
                    </materialDesign:Card>

                    <!-- Underlying Symbol -->
                    <materialDesign:Card Background="#262638" Margin="0,0,0,10" Padding="15">
                        <StackPanel>
                            <TextBlock Text="UNDERLYING SYMBOL" FontWeight="Bold" Foreground="#1E90FF" Margin="0,0,0,10"/>
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>
                                <TextBox x:Name="SymbolTextBox" 
                                        Grid.Column="0"
                                        Style="{StaticResource EnhancedTextBoxStyle}"
                                        materialDesign:HintAssist.Hint="Enter Symbol (e.g., AAPL)"
                                        Text="{Binding UnderlyingSymbol, UpdateSourceTrigger=PropertyChanged}"/>
                                <Button x:Name="LoadSymbolButton" 
                                       Grid.Column="1"
                                       Content="LOAD" 
                                       Margin="10,0,0,0"
                                       Click="LoadSymbolButton_Click"
                                       Style="{StaticResource EnhancedButtonStyle}"/>
                            </Grid>
                            <TextBlock x:Name="UnderlyingPriceText" 
                                      Text="{Binding UnderlyingPriceDisplay}" 
                                      Foreground="Cyan" 
                                      FontWeight="Bold" 
                                      Margin="0,5,0,0"/>
                        </StackPanel>
                    </materialDesign:Card>

                    <!-- Option Legs Configuration -->
                    <materialDesign:Card Background="#262638" Margin="0,0,0,10" Padding="15">
                        <StackPanel>
                            <TextBlock Text="OPTION LEGS" FontWeight="Bold" Foreground="#1E90FF" Margin="0,0,0,10"/>
                            <ItemsControl x:Name="OptionLegsItemsControl" ItemsSource="{Binding OptionLegs}">
                                <ItemsControl.ItemTemplate>
                                    <DataTemplate>
                                        <Border Background="#1B1B2A" 
                                               BorderBrush="#3E3E56" 
                                               BorderThickness="1" 
                                               CornerRadius="5" 
                                               Margin="0,0,0,10" 
                                               Padding="10">
                                            <Grid>
                                                <Grid.RowDefinitions>
                                                    <RowDefinition Height="Auto"/>
                                                    <RowDefinition Height="Auto"/>
                                                    <RowDefinition Height="Auto"/>
                                                </Grid.RowDefinitions>
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="*"/>
                                                    <ColumnDefinition Width="*"/>
                                                </Grid.ColumnDefinitions>

                                                <!-- Action and Type -->
                                                <ComboBox Grid.Row="0" Grid.Column="0" 
                                                         Style="{StaticResource EnhancedComboBoxStyle}"
                                                         materialDesign:HintAssist.Hint="Action"
                                                         SelectedValue="{Binding Action}"
                                                         Margin="0,0,5,5">
                                                    <ComboBoxItem Content="BUY"/>
                                                    <ComboBoxItem Content="SELL"/>
                                                </ComboBox>
                                                
                                                <ComboBox Grid.Row="0" Grid.Column="1" 
                                                         Style="{StaticResource EnhancedComboBoxStyle}"
                                                         materialDesign:HintAssist.Hint="Type"
                                                         SelectedValue="{Binding Option.OptionType}"
                                                         Margin="5,0,0,5">
                                                    <ComboBoxItem Content="CALL"/>
                                                    <ComboBoxItem Content="PUT"/>
                                                </ComboBox>

                                                <!-- Strike and Expiry -->
                                                <TextBox Grid.Row="1" Grid.Column="0" 
                                                        Style="{StaticResource EnhancedTextBoxStyle}"
                                                        materialDesign:HintAssist.Hint="Strike Price"
                                                        Text="{Binding Option.StrikePrice}"
                                                        Margin="0,0,5,5"/>
                                                
                                                <DatePicker Grid.Row="1" Grid.Column="1" 
                                                           Style="{StaticResource EnhancedDatePickerStyle}"
                                                           materialDesign:HintAssist.Hint="Expiry Date"
                                                           SelectedDate="{Binding Option.ExpirationDate}"
                                                           Margin="5,0,0,5"/>

                                                <!-- Price and Quantity -->
                                                <TextBox Grid.Row="2" Grid.Column="0" 
                                                        Style="{StaticResource EnhancedTextBoxStyle}"
                                                        materialDesign:HintAssist.Hint="Price"
                                                        Text="{Binding Price}"
                                                        Margin="0,0,5,0"/>
                                                
                                                <TextBox Grid.Row="2" Grid.Column="1" 
                                                        Style="{StaticResource EnhancedTextBoxStyle}"
                                                        materialDesign:HintAssist.Hint="Quantity"
                                                        Text="{Binding Quantity}"
                                                        Margin="5,0,0,0"/>
                                            </Grid>
                                        </Border>
                                    </DataTemplate>
                                </ItemsControl.ItemTemplate>
                            </ItemsControl>
                            
                            <Button x:Name="AddLegButton" 
                                   Content="ADD LEG" 
                                   Click="AddLegButton_Click"
                                   Style="{StaticResource EnhancedButtonStyle}"
                                   Margin="0,10,0,0"/>
                        </StackPanel>
                    </materialDesign:Card>

                    <!-- Calculate Button -->
                    <Button x:Name="CalculateButton" 
                           Content="CALCULATE P&amp;L" 
                           Click="CalculateButton_Click"
                           Style="{StaticResource EnhancedButtonStyle}"
                           Background="{StaticResource AccentBlueBrush}"
                           Margin="0,0,0,10"/>

                    <!-- Metrics Display -->
                    <materialDesign:Card Background="#262638" Margin="0,0,0,10" Padding="15">
                        <StackPanel>
                            <TextBlock Text="SPREAD METRICS" FontWeight="Bold" Foreground="#1E90FF" Margin="0,0,0,10"/>
                            
                            <Grid>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                </Grid.RowDefinitions>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>

                                <TextBlock Grid.Row="0" Grid.Column="0" Text="Net Cost:" Foreground="LightGray"/>
                                <TextBlock Grid.Row="0" Grid.Column="1" Text="{Binding NetCostDisplay}" Foreground="Cyan" HorizontalAlignment="Right"/>

                                <TextBlock Grid.Row="1" Grid.Column="0" Text="Max Profit:" Foreground="LightGray"/>
                                <TextBlock Grid.Row="1" Grid.Column="1" Text="{Binding MaxProfitDisplay}" Foreground="LimeGreen" HorizontalAlignment="Right"/>

                                <TextBlock Grid.Row="2" Grid.Column="0" Text="Max Loss:" Foreground="LightGray"/>
                                <TextBlock Grid.Row="2" Grid.Column="1" Text="{Binding MaxLossDisplay}" Foreground="Red" HorizontalAlignment="Right"/>

                                <TextBlock Grid.Row="3" Grid.Column="0" Text="Breakeven:" Foreground="LightGray"/>
                                <TextBlock Grid.Row="3" Grid.Column="1" Text="{Binding BreakevenDisplay}" Foreground="Yellow" HorizontalAlignment="Right"/>

                                <TextBlock Grid.Row="4" Grid.Column="0" Text="POP:" Foreground="LightGray"/>
                                <TextBlock Grid.Row="4" Grid.Column="1" Text="{Binding ProbabilityOfProfitDisplay}" Foreground="Orange" HorizontalAlignment="Right"/>
                            </Grid>
                        </StackPanel>
                    </materialDesign:Card>

                </StackPanel>
            </ScrollViewer>

            <!-- Right Panel - Visualization -->
            <Grid Grid.Column="1" Margin="5,5,10,10">
                <Grid.RowDefinitions>
                    <RowDefinition Height="*"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>

                <!-- Payoff Diagram -->
                <materialDesign:Card Grid.Row="0" Background="#262638" Padding="15">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="*"/>
                        </Grid.RowDefinitions>

                        <TextBlock Grid.Row="0" 
                                  Text="PAYOFF DIAGRAM" 
                                  FontWeight="Bold" 
                                  Foreground="#1E90FF" 
                                  HorizontalAlignment="Center" 
                                  Margin="0,0,0,15"/>

                        <lvc:CartesianChart Grid.Row="1" 
                                           x:Name="PayoffChart"
                                           Series="{Binding PayoffSeries}" 
                                           LegendLocation="Bottom"
                                           Background="Transparent">
                            <lvc:CartesianChart.AxisX>
                                <lvc:Axis Title="Underlying Price at Expiry" 
                                         Foreground="White" 
                                         FontSize="12">
                                    <lvc:Axis.Separator>
                                        <lvc:Separator StrokeThickness="1" 
                                                      StrokeDashArray="2" 
                                                      Stroke="#404040"/>
                                    </lvc:Axis.Separator>
                                </lvc:Axis>
                            </lvc:CartesianChart.AxisX>
                            <lvc:CartesianChart.AxisY>
                                <lvc:Axis Title="Profit/Loss ($)" 
                                         Foreground="White" 
                                         FontSize="12">
                                    <lvc:Axis.Separator>
                                        <lvc:Separator StrokeThickness="1" 
                                                      StrokeDashArray="2" 
                                                      Stroke="#404040"/>
                                    </lvc:Axis.Separator>
                                </lvc:Axis>
                            </lvc:CartesianChart.AxisY>
                        </lvc:CartesianChart>
                    </Grid>
                </materialDesign:Card>

                <!-- Greeks Display -->
                <materialDesign:Card Grid.Row="1" Background="#262638" Margin="0,10,0,0" Padding="15">
                    <StackPanel>
                        <TextBlock Text="GREEKS SUMMARY" FontWeight="Bold" Foreground="#1E90FF" Margin="0,0,0,10"/>
                        
                        <StackPanel Orientation="Horizontal" HorizontalAlignment="Stretch">
                            <StackPanel Margin="0,0,20,0">
                                <TextBlock Text="Delta" Foreground="LightGray" HorizontalAlignment="Center"/>
                                <TextBlock Text="{Binding TotalDelta}" Foreground="Cyan" FontWeight="Bold" HorizontalAlignment="Center"/>
                            </StackPanel>
                            <StackPanel Margin="0,0,20,0">
                                <TextBlock Text="Gamma" Foreground="LightGray" HorizontalAlignment="Center"/>
                                <TextBlock Text="{Binding TotalGamma}" Foreground="Cyan" FontWeight="Bold" HorizontalAlignment="Center"/>
                            </StackPanel>
                            <StackPanel Margin="0,0,20,0">
                                <TextBlock Text="Theta" Foreground="LightGray" HorizontalAlignment="Center"/>
                                <TextBlock Text="{Binding TotalTheta}" Foreground="Red" FontWeight="Bold" HorizontalAlignment="Center"/>
                            </StackPanel>
                            <StackPanel Margin="0,0,20,0">
                                <TextBlock Text="Vega" Foreground="LightGray" HorizontalAlignment="Center"/>
                                <TextBlock Text="{Binding TotalVega}" Foreground="Orange" FontWeight="Bold" HorizontalAlignment="Center"/>
                            </StackPanel>
                            <StackPanel>
                                <TextBlock Text="Implied Vol" Foreground="LightGray" HorizontalAlignment="Center"/>
                                <TextBlock Text="{Binding AverageImpliedVolatility}" Foreground="Yellow" FontWeight="Bold" HorizontalAlignment="Center"/>
                            </StackPanel>
                        </StackPanel>
                    </StackPanel>
                </materialDesign:Card>

            </Grid>
        </Grid>
    </Grid>
</UserControl>