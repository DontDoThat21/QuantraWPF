<UserControl x:Class="Quantra.Controls.BatchPredictionControl"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             mc:Ignorable="d" 
             d:DesignHeight="600" d:DesignWidth="900"
             Background="#1E1E30">
    
    <UserControl.Resources>
        <ResourceDictionary>
            <ResourceDictionary.MergedDictionaries>
                <ResourceDictionary Source="/Styles/EnhancedStyles.xaml"/>
            </ResourceDictionary.MergedDictionaries>
        </ResourceDictionary>
    </UserControl.Resources>

    <Grid Margin="15">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/> <!-- Title -->
            <RowDefinition Height="Auto"/> <!-- Configuration -->
            <RowDefinition Height="Auto"/> <!-- Control Buttons -->
            <RowDefinition Height="Auto"/> <!-- Progress Bar -->
            <RowDefinition Height="Auto"/> <!-- Status -->
            <RowDefinition Height="*"/>    <!-- Metrics -->
        </Grid.RowDefinitions>

        <!-- Title -->
        <TextBlock Grid.Row="0" 
                   Text="🌙 Overnight Batch Prediction Generator" 
                   FontSize="24" 
                   FontWeight="Bold" 
                   Foreground="Cyan" 
                   Margin="0,0,0,20"
                   HorizontalAlignment="Center"/>

        <!-- Configuration Panel -->
        <Border Grid.Row="1" 
                Background="#2D2D42" 
                BorderBrush="#3E3E56" 
                BorderThickness="1" 
                CornerRadius="5" 
                Padding="15" 
                Margin="0,0,0,15">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>

                <!-- Row 1: Basic Options -->
                <StackPanel Grid.Row="0" Grid.Column="0" Margin="0,0,10,10">
                    <TextBlock Text="Timeframe:" 
                               Foreground="White" 
                               FontSize="12" 
                               Margin="0,0,0,5"/>
                    <ComboBox x:Name="TimeframeComboBox" 
                              Style="{StaticResource EnhancedComboBoxStyle}">
                        <ComboBoxItem Content="1 Day" Tag="1day" IsSelected="True"/>
                        <ComboBoxItem Content="1 Week" Tag="1week"/>
                        <ComboBoxItem Content="1 Month" Tag="1month"/>
                    </ComboBox>
                </StackPanel>

                <StackPanel Grid.Row="0" Grid.Column="1" Margin="0,0,10,10">
                    <TextBlock Text="Model Type:" 
                               Foreground="White" 
                               FontSize="12" 
                               Margin="0,0,0,5"/>
                    <ComboBox x:Name="ModelTypeComboBox" 
                              Style="{StaticResource EnhancedComboBoxStyle}">
                        <ComboBoxItem Content="Auto (Best Available)" Tag="auto" IsSelected="True"/>
                        <ComboBoxItem Content="PyTorch" Tag="pytorch"/>
                        <ComboBoxItem Content="TensorFlow" Tag="tensorflow"/>
                        <ComboBoxItem Content="Random Forest" Tag="random_forest"/>
                    </ComboBox>
                </StackPanel>

                <StackPanel Grid.Row="0" Grid.Column="2" Margin="0,0,0,10">
                    <TextBlock Text="Max Symbols (optional):" 
                               Foreground="White" 
                               FontSize="12" 
                               Margin="0,0,0,5"/>
                    <TextBox x:Name="MaxSymbolsTextBox" 
                             Style="{StaticResource EnhancedTextBoxStyle}"
                             ToolTip="Leave blank to process all symbols"/>
                </StackPanel>

                <!-- Row 2: Advanced Options -->
                <StackPanel Grid.Row="1" Grid.Column="0" Margin="0,0,10,0">
                    <TextBlock Text="Sector Filter:" 
                               Foreground="White" 
                               FontSize="12" 
                               Margin="0,0,0,5"/>
                    <ComboBox x:Name="SectorComboBox" 
                              Style="{StaticResource EnhancedComboBoxStyle}">
                        <ComboBoxItem Content="All Sectors" IsSelected="True"/>
                        <ComboBoxItem Content="Technology"/>
                        <ComboBoxItem Content="Healthcare"/>
                        <ComboBoxItem Content="Financial Services"/>
                        <ComboBoxItem Content="Consumer Cyclical"/>
                        <ComboBoxItem Content="Industrials"/>
                        <ComboBoxItem Content="Energy"/>
                        <ComboBoxItem Content="Communication Services"/>
                    </ComboBox>
                </StackPanel>

                <StackPanel Grid.Row="1" Grid.Column="1" Grid.ColumnSpan="2" 
                            Orientation="Vertical" 
                            VerticalAlignment="Center" 
                            Margin="0,15,0,0">
                    <CheckBox x:Name="SkipRecentCheckBox" 
                              Content="Skip symbols with predictions from last 24 hours" 
                              Foreground="White" 
                              IsChecked="True"
                              Style="{StaticResource EnhancedCheckBoxStyle}"
                              Checked="SkipRecentCheckBox_Checked"/>
                    <TextBlock Text="💡 Recommended: Saves time by only updating stale predictions" 
                               Foreground="#AAAAAA" 
                               FontSize="10" 
                               Margin="30,5,0,0" 
                               TextWrapping="Wrap"/>
                </StackPanel>
            </Grid>
        </Border>

        <!-- Control Buttons -->
        <Border Grid.Row="2" 
                Background="#2D2D42" 
                BorderBrush="#3E3E56" 
                BorderThickness="1" 
                CornerRadius="5" 
                Padding="15" 
                Margin="0,0,0,15">
            <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                <Button x:Name="StartButton" 
                        Content="▶ Start Batch Prediction" 
                        Width="200" 
                        Height="50" 
                        Click="StartButton_Click"
                        Style="{StaticResource EnhancedButtonStyle}"
                        FontSize="16" 
                        FontWeight="Bold"/>
                
                <TextBlock Margin="20,0,0,0" 
                           VerticalAlignment="Center">
                    <Run Text="⏱ Estimated Time:" 
                         Foreground="#AAAAAA"/>
                    <LineBreak/>
                    <Run Text="~2-4 hours for 12,000 symbols" 
                         Foreground="White" 
                         FontWeight="Bold"/>
                </TextBlock>
            </StackPanel>
        </Border>

        <!-- Progress Bar -->
        <Border Grid.Row="3" 
                Background="#2D2D42" 
                BorderBrush="#3E3E56" 
                BorderThickness="1" 
                CornerRadius="5" 
                Padding="15" 
                Margin="0,0,0,15">
            <StackPanel>
                <ProgressBar x:Name="ProgressBar" 
                             Height="30" 
                             Minimum="0" 
                             Maximum="100" 
                             Value="0"
                             Foreground="Cyan" 
                             Background="#1E1E30"/>
                
                <TextBlock x:Name="StatusText" 
                           Text="Ready to start batch prediction" 
                           Foreground="White" 
                           FontSize="14" 
                           HorizontalAlignment="Center" 
                           Margin="0,10,0,0"/>
            </StackPanel>
        </Border>

        <!-- Metrics Dashboard -->
        <Border Grid.Row="5" 
                Background="#2D2D42" 
                BorderBrush="#3E3E56" 
                BorderThickness="1" 
                CornerRadius="5" 
                Padding="15">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>

                <TextBlock Grid.Row="0" 
                           Text="📊 Real-Time Metrics" 
                           FontSize="18" 
                           FontWeight="Bold" 
                           Foreground="Cyan" 
                           Margin="0,0,0,15"/>

                <Grid Grid.Row="1">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>

                    <!-- Left Column: Symbol Stats -->
                    <StackPanel Grid.Column="0" Margin="0,0,10,0">
                        <Border Background="#3E3E56" 
                                CornerRadius="5" 
                                Padding="15" 
                                Margin="0,0,0,10">
                            <StackPanel>
                                <TextBlock Text="Symbol Statistics" 
                                           FontWeight="Bold" 
                                           Foreground="White" 
                                           FontSize="14" 
                                           Margin="0,0,0,10"/>
                                
                                <TextBlock x:Name="TotalSymbolsText" 
                                           Text="Total: 0" 
                                           Foreground="White" 
                                           FontSize="16" 
                                           Margin="0,5"/>
                                <TextBlock x:Name="ProcessedText" 
                                           Text="Processed: 0" 
                                           Foreground="White" 
                                           FontSize="16" 
                                           Margin="0,5"/>
                                <TextBlock x:Name="SuccessText" 
                                           Text="Success: 0" 
                                           Foreground="LimeGreen" 
                                           FontSize="16" 
                                           Margin="0,5"/>
                                <TextBlock x:Name="FailedText" 
                                           Text="Failed: 0" 
                                           Foreground="Red" 
                                           FontSize="16" 
                                           Margin="0,5"/>
                                <TextBlock x:Name="SuccessRateText" 
                                           Text="Success Rate: 0%" 
                                           Foreground="Cyan" 
                                           FontSize="16" 
                                           FontWeight="Bold" 
                                           Margin="0,10,0,0"/>
                            </StackPanel>
                        </Border>
                    </StackPanel>

                    <!-- Middle Column: Progress Info -->
                    <StackPanel Grid.Column="1" Margin="5,0">
                        <Border Background="#3E3E56" 
                                CornerRadius="5" 
                                Padding="15" 
                                Margin="0,0,0,10">
                            <StackPanel>
                                <TextBlock Text="Current Progress" 
                                           FontWeight="Bold" 
                                           Foreground="White" 
                                           FontSize="14" 
                                           Margin="0,0,0,10"/>
                                
                                <TextBlock x:Name="CurrentSymbolText" 
                                           Text="Current: -" 
                                           Foreground="Yellow" 
                                           FontSize="16" 
                                           Margin="0,5"
                                           TextTrimming="CharacterEllipsis"/>
                                <TextBlock x:Name="ElapsedTimeText" 
                                           Text="Elapsed: 00:00:00" 
                                           Foreground="White" 
                                           FontSize="16" 
                                           Margin="0,5"/>
                                <TextBlock x:Name="EstimatedTimeText" 
                                           Text="ETA: 00:00:00" 
                                           Foreground="Cyan" 
                                           FontSize="16" 
                                           Margin="0,5"/>
                                <TextBlock x:Name="SpeedText" 
                                           Text="Speed: 0 pred/sec" 
                                           Foreground="White" 
                                           FontSize="16" 
                                           Margin="0,5"/>
                            </StackPanel>
                        </Border>
                    </StackPanel>

                    <!-- Right Column: Tips -->
                    <StackPanel Grid.Column="2" Margin="10,0,0,0">
                        <Border Background="#3E3E56" 
                                CornerRadius="5" 
                                Padding="15">
                            <StackPanel>
                                <TextBlock Text="💡 Tips" 
                                           FontWeight="Bold" 
                                           Foreground="Cyan" 
                                           FontSize="14" 
                                           Margin="0,0,0,10"/>
                                
                                <TextBlock TextWrapping="Wrap" 
                                           Foreground="White" 
                                           FontSize="12" 
                                           Margin="0,5">
                                    <Run Text="Run overnight"/>
                                    <LineBreak/>
                                    <Run Text="  (2-4 hours for 12K symbols)"/>
                                </TextBlock>
                                
                                <TextBlock TextWrapping="Wrap" 
                                           Foreground="White" 
                                           FontSize="12" 
                                           Margin="0,5">
                                    <Run Text="• Predictions cached for"/>
                                    <LineBreak/>
                                    <Run Text="  fast retrieval"/>
                                </TextBlock>
                                
                                <TextBlock TextWrapping="Wrap" 
                                           Foreground="White" 
                                           FontSize="12" 
                                           Margin="0,5">
                                    <Run Text="• Skip recent to save time"/>
                                </TextBlock>
                                
                                <TextBlock TextWrapping="Wrap" 
                                           Foreground="White" 
                                           FontSize="12" 
                                           Margin="0,5">
                                    <Run Text="• Can cancel anytime"/>
                                </TextBlock>
                                
                                <TextBlock TextWrapping="Wrap" 
                                           Foreground="#FFD700" 
                                           FontSize="12" 
                                           FontWeight="Bold" 
                                           Margin="0,10,0,0">
                                    <Run Text="⚡ Progress is saved!"/>
                                    <LineBreak/>
                                    <Run Text="Safe to restart"/>
                                </TextBlock>
                            </StackPanel>
                        </Border>
                    </StackPanel>
                </Grid>
            </Grid>
        </Border>
    </Grid>
</UserControl>
