<UserControl x:Class="Quantra.Controls.PredictionAnalysis"
xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
xmlns:local="clr-namespace:Quantra.Controls"
xmlns:lvc="clr-namespace:LiveCharts.Wpf;assembly=LiveCharts.Wpf"
xmlns:converters="clr-namespace:Quantra.Converters"
mc:Ignorable="d" 
d:DesignHeight="450" d:DesignWidth="800"
Background="#1E1E30"
HorizontalAlignment="Stretch" 
VerticalAlignment="Stretch"
Width="Auto" Height="Auto"
MinWidth="400" MinHeight="300">

    <!-- Add reference to the converter in resources section -->
    <UserControl.Resources>
        <ResourceDictionary>
            <ResourceDictionary.MergedDictionaries>
                <ResourceDictionary Source="/Styles/EnhancedStyles.xaml"/>
            </ResourceDictionary.MergedDictionaries>

            <BooleanToVisibilityConverter x:Key="BooleanToVisibilityConverter"/>
            <converters:NullToBooleanConverter x:Key="NullToBooleanConverter"/>
            <converters:NullToCollapsedConverter x:Key="NullToCollapsedConverter"/>
            <converters:GreaterThanConverter x:Key="GreaterThanConverter"/>
            <converters:LessThanConverter x:Key="LessThanConverter"/>
            <!-- Add duration resources for consistent animations -->
            <Duration x:Key="StandardAnimationDuration">0:0:0.3</Duration>
        </ResourceDictionary>
    </UserControl.Resources>

    <!-- Main grid needs explicit sizing to ensure proper rendering -->
    <Grid Margin="10" HorizontalAlignment="Stretch" VerticalAlignment="Stretch">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <!-- Title and Controls -->
            <RowDefinition Height="Auto"/>
            <!-- Analysis Parameters -->
            <RowDefinition Height="*" MinHeight="150"/>
            <!-- Top Predictions Grid (fills available space) -->
            <RowDefinition Height="Auto"/>
            <!-- Status Bar -->
        </Grid.RowDefinitions>

        <!-- Title and Controls - Add Auto Mode Toggle -->
        <Grid Grid.Row="0" Margin="0,5">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>

            <TextBlock Grid.Column="0" Text="Prediction Analysis" FontSize="22" 
                       FontWeight="Bold" Foreground="White" Margin="5,0,0,10"/>

            <StackPanel Grid.Column="1" Orientation="Horizontal" HorizontalAlignment="Right" VerticalAlignment="Center">

                <!-- Selected Trading Strategy -->
                <StackPanel Orientation="Vertical" Margin="0,0,10,0">
                    <TextBlock Text="Trading Strategy:" Foreground="White" FontSize="11" Margin="0,0,0,3"/>
                    <ComboBox x:Name="TradingStrategy" 
                              ToolTip="Select trading strategy for prediction analysis and backtesting"
                              SelectionChanged="TradingStrategy_SelectionChanged"
                              Style="{StaticResource EnhancedComboBoxStyle}"
                              VerticalContentAlignment="Center"
                              MinWidth="250">
                        <!-- Built-In Technical Strategies -->
                        <ComboBoxItem Content="SMA Crossover (20/50)" Tag="SMA" 
                                      ToolTip="Fast/Slow moving average crossover - Best for trend-following"/>
                        <ComboBoxItem Content="MACD Crossover" Tag="MACD" IsSelected="True"
                                      ToolTip="MACD line crosses signal line - Best for momentum trading"/>
                        <ComboBoxItem Content="RSI Divergence (14)" Tag="RSI"
                                      ToolTip="Overbought/oversold conditions - Best for mean reversion"/>
                        <ComboBoxItem Content="Bollinger Bands Mean Reversion" Tag="BB"
                                      ToolTip="Price touches bands - Best for range-bound markets"/>
                        
                        <Separator Margin="0,5"/>
                        
                        <!-- ML-Driven Strategies (from documentation) -->
                        <ComboBoxItem Content="ML High-Confidence Swing" Tag="ML_SWING"
                                      ToolTip="Capture 5-10% moves with 75%+ confidence ML signals"/>
                        <ComboBoxItem Content="ML Confirmed Breakouts" Tag="ML_BREAKOUT"
                                      ToolTip="Technical breakouts confirmed by 80%+ confidence ML"/>
                        <ComboBoxItem Content="Sentiment Reversal" Tag="SENTIMENT_REVERSAL"
                                      ToolTip="Trade sentiment extremes with ML confirmation"/>
                        <ComboBoxItem Content="Earnings Season Strategy" Tag="EARNINGS"
                                      ToolTip="Trade around earnings using ML + sentiment analysis"/>
                        <ComboBoxItem Content="ML Portfolio Optimization" Tag="ML_PORTFOLIO"
                                      ToolTip="Build optimal ML-driven diversified portfolio"/>
                        
                        <Separator Margin="0,5"/>
                        
                        <!-- Custom Strategy Option -->
                        <ComboBoxItem Content="Custom Strategy..." Tag="CUSTOM"
                                      ToolTip="Create or load a custom trading strategy"/>
                    </ComboBox>
                </StackPanel>

                <!-- Update Rate -->
                <StackPanel Orientation="Vertical" Margin="0,0,10,0">
                    <TextBlock Text="Update Rate:" Foreground="White" FontSize="11" Margin="0,0,0,3"/>
                    <ComboBox x:Name="AutoModeToggle2" 
                              MinWidth="130"
                              ToolTip="Enable/Disable Data updates every 15 minutes during trading hours, or if data is > 15m old."
                              Style="{StaticResource EnhancedComboBoxStyle}"
                              VerticalContentAlignment="Center">
                        <ComboBoxItem Content="15m" Tag="15m" IsSelected="True"/>
                        <ComboBoxItem Content="30m" Tag="30m"/>
                        <ComboBoxItem Content="1h" Tag="1h"/>
                        <ComboBoxItem Content="2h" Tag="2h"/>
                        <ComboBoxItem Content="3h" Tag="3h"/>
                    </ComboBox>
                </StackPanel>

                <!-- Auto Mode Toggle -->
                <Border Background="#3E3E56" BorderThickness="1" Margin="0,0,10,0" 
                        CornerRadius="3" Padding="6,6" Height="40">
                    <StackPanel Orientation="Horizontal">
                        <TextBlock Text="Auto Mode" Foreground="White" VerticalAlignment="Center" Margin="0,0,8,0"/>
                        <ToggleButton x:Name="AutoModeToggle" Width="40" Height="20"
                              IsChecked="{Binding IsAutomatedMode, Mode=TwoWay, RelativeSource={RelativeSource FindAncestor, AncestorType={x:Type local:PredictionAnalysis}}}"
                                      ToolTip="Enable/Disable automated analysis at regular intervals">
                            <ToggleButton.Style>
                                <Style TargetType="ToggleButton">
                                    <Setter Property="Template">
                                        <Setter.Value>
                                            <ControlTemplate TargetType="ToggleButton">
                                                <Border x:Name="ToggleBorder" Background="#333344" CornerRadius="10" 
                                                        BorderThickness="1" BorderBrush="#666677">
                                                    <Grid>
                                                        <Ellipse x:Name="SwitchKnob" Width="16" Height="16" 
                                                                 HorizontalAlignment="Left" Margin="2,0,0,0"
                                                                 Fill="#CCCCCC"/>
                                                    </Grid>
                                                </Border>
                                                <ControlTemplate.Triggers>
                                                    <Trigger Property="IsChecked" Value="True">
                                                        <Setter TargetName="ToggleBorder" Property="Background" Value="#006666"/>
                                                        <Setter TargetName="SwitchKnob" Property="Fill" Value="Cyan"/>
                                                        <Setter TargetName="SwitchKnob" Property="HorizontalAlignment" Value="Right"/>
                                                        <Setter TargetName="SwitchKnob" Property="Margin" Value="0,0,2,0"/>
                                                    </Trigger>
                                                </ControlTemplate.Triggers>
                                            </ControlTemplate>
                                        </Setter.Value>
                                    </Setter>
                                </Style>
                            </ToggleButton.Style>
                        </ToggleButton>
                    </StackPanel>
                </Border>

                <Button x:Name="RefreshButton" Content="↻" Width="40" Height="40" 
                        Click="RefreshButton_Click"
                        Background="#3E3E56" Foreground="White" 
                        BorderBrush="Cyan" Margin="0,0,5,0"/>
            </StackPanel>
        </Grid>

        <!-- Analysis Parameters -->
        <Grid Grid.Row="1" Margin="0,5" Background="#2D2D42">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>  <!-- Symbol selection row -->
                <RowDefinition Height="Auto"/>  <!-- Indicators row -->
                <RowDefinition Height="Auto"/>  <!-- Model Training row -->
            </Grid.RowDefinitions>

            <!-- Symbol Selection Mode -->
            <StackPanel Grid.Row="0" Grid.Column="0" Margin="10,5">
                <TextBlock Text="Symbol Selection Mode:" Foreground="White" Margin="0,5"/>
                <ComboBox x:Name="SymbolModeComboBox"
                          SelectionChanged="SymbolModeComboBox_SelectionChanged"
                          Style="{StaticResource EnhancedComboBoxStyle}"
                          ToolTip="Choose how to select symbols for analysis">
                    <ComboBoxItem Content="Individual Symbol" IsSelected="True"/>
                    <ComboBoxItem Content="Category Filter"/>
                </ComboBox>
            </StackPanel>

            <!-- Individual Symbol Controls (visible when Individual Symbol mode is selected) -->
            <Grid x:Name="IndividualSymbolPanel" Grid.Row="0" Grid.Column="1" Margin="10,5" Visibility="Visible">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <!-- Manual Symbol Entry -->
                <StackPanel Grid.Row="0" Grid.Column="0" Grid.ColumnSpan="2">
                    <TextBlock Text="Enter Symbol:" Foreground="White" Margin="0,5"/>
                    <TextBox x:Name="ManualSymbolTextBox"
                             Text="AAPL"
                             Style="{StaticResource EnhancedTextBoxStyle}"
                             ToolTip="Enter a stock symbol (e.g., AAPL, MSFT, GOOGL)"
                             KeyDown="ManualSymbolTextBox_KeyDown"/>
                </StackPanel>

                <!-- Cached Symbols Search -->
                <StackPanel Grid.Row="1" Grid.Column="0" Margin="0,5,5,0">
                    <TextBlock Text="Or Search Cached Symbols:" Foreground="White" Margin="0,5"/>
                    <Grid>
                        <TextBox x:Name="CachedSymbolSearchTextBox"
                                 Style="{StaticResource EnhancedTextBoxStyle}"
                                 TextChanged="CachedSymbolSearchTextBox_TextChanged"
                                 PreviewKeyDown="CachedSymbolSearchTextBox_PreviewKeyDown"
                                 GotFocus="CachedSymbolSearchTextBox_GotFocus"
                                 LostFocus="CachedSymbolSearchTextBox_LostFocus"
                                 ToolTip="Type to search cached symbols (e.g., AAPL, MSFT, GOOGL)"/>
                        <Popup x:Name="CachedSymbolSearchPopup"
                               PlacementTarget="{Binding ElementName=CachedSymbolSearchTextBox}"
                               Placement="Bottom"
                               Width="350"
                               MaxHeight="300"
                               StaysOpen="False"
                               AllowsTransparency="True">
                            <Border Background="#2D2D4D"
                                    BorderBrush="#3E3E56"
                                    BorderThickness="1"
                                    CornerRadius="3">
                                <Grid>
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="*"/>
                                    </Grid.RowDefinitions>

                                    <TextBlock x:Name="CachedSymbolSearchLoadingText"
                                               Grid.Row="0"
                                               Text="Searching cached symbols..."
                                               Foreground="White"
                                               FontStyle="Italic"
                                               Margin="10,5"
                                               Visibility="Collapsed"/>

                                    <ListBox x:Name="CachedSymbolSearchResultsListBox"
                                             Grid.Row="1"
                                             Background="Transparent"
                                             BorderThickness="0"
                                             Foreground="White"
                                             MouseLeftButtonUp="CachedSymbolSearchResultsListBox_MouseLeftButtonUp"
                                             PreviewKeyDown="CachedSymbolSearchResultsListBox_PreviewKeyDown">
                                        <ListBox.ItemTemplate>
                                            <DataTemplate>
                                                <StackPanel Orientation="Vertical" Margin="5">
                                                    <TextBlock Text="{Binding Symbol}" FontWeight="Bold" Foreground="White"/>
                                                    <TextBlock Text="{Binding CacheInfo}" Foreground="Gray" FontSize="10"/>
                                                </StackPanel>
                                            </DataTemplate>
                                        </ListBox.ItemTemplate>
                                        <ListBox.ItemContainerStyle>
                                            <Style TargetType="ListBoxItem">
                                                <Setter Property="Background" Value="Transparent"/>
                                                <Setter Property="Foreground" Value="White"/>
                                                <Style.Triggers>
                                                    <Trigger Property="IsMouseOver" Value="True">
                                                        <Setter Property="Background" Value="#3E3E56"/>
                                                    </Trigger>
                                                    <Trigger Property="IsSelected" Value="True">
                                                        <Setter Property="Background" Value="#4A4A66"/>
                                                    </Trigger>
                                                </Style.Triggers>
                                            </Style>
                                        </ListBox.ItemContainerStyle>
                                    </ListBox>
                                </Grid>
                            </Border>
                        </Popup>
                    </Grid>
                </StackPanel>

                <!-- Refresh Cache Button -->
                <Button Grid.Row="1" Grid.Column="1" x:Name="RefreshCacheButton"
                        Content="↻"
                        Click="RefreshCacheButton_Click"
                        Style="{StaticResource EnhancedButtonStyle}"
                        Width="30" Height="30"
                        Margin="0,25,0,0"
                        ToolTip="Refresh cached symbols list"/>
            </Grid>

            <!-- Category Filter Controls (visible when Category Filter mode is selected) -->
            <StackPanel x:Name="CategoryFilterPanel" Grid.Row="0" Grid.Column="1" Margin="10,5" Visibility="Collapsed">
                <TextBlock Text="Symbol Category:" Foreground="White" Margin="0,5"/>
                <ComboBox x:Name="SymbolFilterComboBox"
                          SelectionChanged="SymbolFilterComboBox_SelectionChanged"
                          Style="{StaticResource EnhancedComboBoxStyle}">
                    <ComboBoxItem Content="All Symbols"/>
                    <ComboBoxItem Content="Top Market Cap" IsSelected="True"/>
                    <ComboBoxItem Content="Tech Sector"/>
                    <ComboBoxItem Content="Financial Sector"/>
                    <ComboBoxItem Content="Healthcare Sector"/>
                    <ComboBoxItem Content="Watchlist"/>
                </ComboBox>
                <TextBlock Text="This will analyze multiple symbols based on the selected category"
                           Foreground="#AAAAAA" FontSize="11" Margin="0,5" TextWrapping="Wrap"/>
            </StackPanel>

            <!-- Timeframe, Analyze Button, and Min Confidence in Right Column -->
            <StackPanel Grid.Row="0" Grid.Column="2" Margin="10,5">
                <!-- Timeframe Selection -->
                <TextBlock Text="Timeframe:" Foreground="White" Margin="0,5"/>
                <ComboBox x:Name="TimeframeComboBox" Margin="0,0,0,10"
                          Style="{StaticResource EnhancedComboBoxStyle}">
                    <ComboBoxItem Content="1 Day" Tag="1day"/>
                    <ComboBoxItem Content="1 Week" Tag="1week"/>
                    <ComboBoxItem Content="1 Month" Tag="1month" IsSelected="True"/>
                    <ComboBoxItem Content="3 Months" Tag="3month"/>
                    <ComboBoxItem Content="1 Year" Tag="1year"/>
                </ComboBox>

                <!-- Analyze Button and Min Confidence Row -->
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>

                    <!-- Analyze Button -->
                    <Button Grid.Column="0" x:Name="AnalyzeButton" Content="Analyze" 
                            Width="100" Height="30" Margin="0,0,10,0" 
                            Click="AnalyzeButton_Click"
                            Background="#3E3E56" Foreground="White" BorderBrush="Cyan"/>

                    <!-- Minimum Confidence -->
                    <StackPanel Grid.Column="1" Orientation="Horizontal">
                        <TextBlock Text="Min Confidence:" Foreground="White" Margin="0,0,5,0" VerticalAlignment="Center"/>
                        <ComboBox x:Name="ConfidenceComboBox" Width="70"
                                  Style="{StaticResource EnhancedComboBoxStyle}">
                            <ComboBoxItem Content="50%" Tag="0.5"/>
                            <ComboBoxItem Content="60%" Tag="0.6" IsSelected="True"/>
                            <ComboBoxItem Content="70%" Tag="0.7"/>
                            <ComboBoxItem Content="80%" Tag="0.8"/>
                            <ComboBoxItem Content="90%" Tag="0.9"/>
                        </ComboBox>
                    </StackPanel>
                </Grid>
            </StackPanel>

            <!-- Indicators Selection - Update with all available indicators -->
            <StackPanel Grid.Row="1" Grid.Column="0" Grid.ColumnSpan="3" 
                      Orientation="Horizontal" Margin="10,10,10,10">
                <TextBlock Text="Indicators:" Foreground="White" Margin="0,0,10,0" VerticalAlignment="Center"/>
                <WrapPanel>
                    <CheckBox x:Name="VwapCheckBox" Content="VWAP" Foreground="White" Margin="5,0" IsChecked="True"
                              Style="{StaticResource EnhancedCheckBoxStyle}"/>
                    <CheckBox x:Name="MacdCheckBox" Content="MACD" Foreground="White" Margin="5,0" IsChecked="True"
                              Style="{StaticResource EnhancedCheckBoxStyle}"/>
                    <CheckBox x:Name="RsiCheckBox" Content="RSI" Foreground="White" Margin="5,0" IsChecked="True"
                              Style="{StaticResource EnhancedCheckBoxStyle}"/>
                    <CheckBox x:Name="BollingerCheckBox" Content="Bollinger" Foreground="White" Margin="5,0" IsChecked="True"
                              Style="{StaticResource EnhancedCheckBoxStyle}"/>
                    <CheckBox x:Name="MaCheckBox" Content="Moving Avg" Foreground="White" Margin="5,0" IsChecked="True"
                              Style="{StaticResource EnhancedCheckBoxStyle}"/>
                    <CheckBox x:Name="VolumeCheckBox" Content="Volume" Foreground="White" Margin="5,0" IsChecked="True"
                              Style="{StaticResource EnhancedCheckBoxStyle}"/>
                    <CheckBox x:Name="BreadthThrustCheckBox" Content="Breadth Thrust" Foreground="White" Margin="5,0" IsChecked="False"
                              Style="{StaticResource EnhancedCheckBoxStyle}"/>
                    <CheckBox x:Name="AdxCheckBox" Content="ADX" Foreground="White" Margin="5,0" IsChecked="False"
                              Style="{StaticResource EnhancedCheckBoxStyle}"/>
                    <CheckBox x:Name="RocCheckBox" Content="ROC" Foreground="White" Margin="5,0" IsChecked="False"
                              Style="{StaticResource EnhancedCheckBoxStyle}"/>
                    <CheckBox x:Name="UoCheckBox" Content="Ult. Osc" Foreground="White" Margin="5,0" IsChecked="False"
                              Style="{StaticResource EnhancedCheckBoxStyle}"/>
                    <CheckBox x:Name="BbpCheckBox" Content="Bull/Bear" Foreground="White" Margin="5,0" IsChecked="False"
                              Style="{StaticResource EnhancedCheckBoxStyle}"/>
                    <CheckBox x:Name="CciCheckBox" Content="CCI" Foreground="White" Margin="5,0" IsChecked="False"
                              Style="{StaticResource EnhancedCheckBoxStyle}"/>
                    <CheckBox x:Name="AtrCheckBox" Content="ATR" Foreground="White" Margin="5,0" IsChecked="False"
                              Style="{StaticResource EnhancedCheckBoxStyle}"/>
                    <CheckBox x:Name="WilliamsRCheckBox" Content="Williams %R" Foreground="White" Margin="5,0" IsChecked="False"
                              Style="{StaticResource EnhancedCheckBoxStyle}"/>
                    <CheckBox x:Name="StochCheckBox" Content="Stochastic" Foreground="White" Margin="5,0" IsChecked="False"
                              Style="{StaticResource EnhancedCheckBoxStyle}"/>
                    <CheckBox x:Name="StochRsiCheckBox" Content="Stoch RSI" Foreground="White" Margin="5,0" IsChecked="False"
                              Style="{StaticResource EnhancedCheckBoxStyle}"/>
                </WrapPanel>
            </StackPanel>

            <!-- Model Training Section -->
            <Border Grid.Row="2" Grid.Column="0" Grid.ColumnSpan="3" 
                    Background="#3E3E56" BorderBrush="Cyan" BorderThickness="1" 
                    CornerRadius="5" Margin="10,10,10,10" Padding="10">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>
                    
                    <!-- First Row: Model Type, Architecture, and Train Button -->
                    <Grid Grid.Row="0">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>

                        <!-- Section Title -->
                        <TextBlock Grid.Column="0" 
                                   Text="🎓 Model Training" 
                                   FontSize="14" FontWeight="Bold" 
                                   Foreground="Cyan" 
                                   VerticalAlignment="Center" 
                                   Margin="0,0,20,0"/>

                        <!-- Model Type Selection -->
                        <StackPanel Grid.Column="1" Orientation="Vertical" Margin="0,0,10,0">
                            <TextBlock Text="Model Type:" Foreground="White" FontSize="11" Margin="0,0,0,3"/>
                            <ComboBox x:Name="ModelTypeComboBox" 
                                      Style="{StaticResource EnhancedComboBoxStyle}"
                                      ToolTip="Select the machine learning model type to train">
                                <ComboBoxItem Content="Auto (Best Available)" IsSelected="True" Tag="auto"/>
                                <ComboBoxItem Content="PyTorch LSTM/GRU" Tag="pytorch"/>
                                <ComboBoxItem Content="TensorFlow LSTM/GRU" Tag="tensorflow"/>
                                <ComboBoxItem Content="Random Forest" Tag="random_forest"/>
                            </ComboBox>
                        </StackPanel>

                        <!-- Architecture Type Selection -->
                        <StackPanel Grid.Column="2" Orientation="Vertical" Margin="10,0">
                            <TextBlock Text="Architecture:" Foreground="White" FontSize="11" Margin="0,0,0,3"/>
                            <ComboBox x:Name="ArchitectureComboBox" 
                                      Style="{StaticResource EnhancedComboBoxStyle}"
                                      ToolTip="Select neural network architecture (for PyTorch/TensorFlow)">
                                <ComboBoxItem Content="LSTM" Tag="lstm"/>
                                <ComboBoxItem Content="GRU" Tag="gru"/>
                                <ComboBoxItem Content="Transformer" Tag="transformer"/>
                                <ComboBoxItem Content="TFT (Temporal Fusion)" IsSelected="True" Tag="tft"
                                              ToolTip="Temporal Fusion Transformer - Multi-horizon forecasting with uncertainty quantification"/>
                            </ComboBox>
                        </StackPanel>

                        <!-- Info Text -->
                        <StackPanel Grid.Column="3" Orientation="Vertical" Margin="10,0,10,0" VerticalAlignment="Center">
                            <TextBlock Text="⚠ Model training required for predictions" 
                                       Foreground="#FFD700" FontSize="10" FontWeight="Bold" TextWrapping="Wrap"/>
                            <TextBlock Text="Train ML model using cached historical data from Stock Explorer" 
                                       Foreground="#AAAAAA" FontSize="9" TextWrapping="Wrap" Margin="0,2,0,0"/>
                            <TextBlock x:Name="TrainingSymbolsCountTextBlock"
                                       Text="" 
                                       Foreground="#888888" FontSize="9" FontStyle="Italic"
                                       Visibility="Collapsed"/>
                        </StackPanel>

                        <!-- Train Model Button -->
                        <Button Grid.Column="4" 
                                x:Name="TrainModelButton"
                                Content="🚀 Train Model" 
                                Width="150" Height="50" 
                                Click="TrainModelButton_Click"
                                Background="#2D6A4C" 
                                Foreground="White" 
                                BorderBrush="Cyan"
                                FontSize="13" FontWeight="Bold"
                                ToolTip="Train the ML model using selected or all cached symbols from the database">
                            <Button.Style>
                                <Style TargetType="Button">
                                    <Setter Property="Template">
                                        <Setter.Value>
                                            <ControlTemplate TargetType="Button">
                                                <Border Background="{TemplateBinding Background}" 
                                                        BorderBrush="{TemplateBinding BorderBrush}" 
                                                        BorderThickness="2" 
                                                        CornerRadius="5" 
                                                        Padding="10">
                                                    <ContentPresenter HorizontalAlignment="Center" 
                                                                      VerticalAlignment="Center"/>
                                                </Border>
                                                <ControlTemplate.Triggers>
                                                    <Trigger Property="IsMouseOver" Value="True">
                                                        <Setter Property="Background" Value="#3E8A5C"/>
                                                    </Trigger>
                                                    <Trigger Property="IsPressed" Value="True">
                                                        <Setter Property="Background" Value="#1E4A3C"/>
                                                    </Trigger>
                                                    <Trigger Property="IsEnabled" Value="False">
                                                        <Setter Property="Background" Value="#555555"/>
                                                        <Setter Property="Foreground" Value="#888888"/>
                                                    </Trigger>
                                                </ControlTemplate.Triggers>
                                            </ControlTemplate>
                                        </Setter.Value>
                                    </Setter>
                                </Style>
                            </Button.Style>
                        </Button>
                    </Grid>
                    
                    <!-- Second Row: Symbol Selection Controls -->
                    <Grid Grid.Row="1" Margin="0,10,0,0">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>

                        <!-- Max Symbols Input -->
                        <StackPanel Grid.Column="0" Orientation="Vertical" Margin="0,0,15,0">
                            <TextBlock Text="Max Symbols:" Foreground="White" FontSize="11" Margin="0,0,0,3"/>
                            <TextBox x:Name="MaxSymbolsTextBox"
                                     Width="100"
                                     Style="{StaticResource EnhancedTextBoxStyle}"
                                     TextChanged="MaxSymbolsTextBox_TextChanged"
                                     ToolTip="Limit the number of symbols to train on (leave blank for all)"/>
                        </StackPanel>

                        <!-- Symbol Selection Button -->
                        <StackPanel Grid.Column="1" Orientation="Vertical" Margin="0,0,10,0">
                            <TextBlock Text="Select Symbols:" Foreground="White" FontSize="11" Margin="0,0,0,3"/>
                            <Button x:Name="SelectTrainingSymbolsButton"
                                    Content="📋 Choose Symbols"
                                    Click="SelectTrainingSymbolsButton_Click"
                                    Style="{StaticResource EnhancedButtonStyle}"
                                    Background="#3A6EA5"
                                    Foreground="White"
                                    Padding="10,5"
                                    ToolTip="Select specific symbols to train on using Stock Configuration Manager"/>
                        </StackPanel>

                        <!-- Clear Selection Button -->
                        <Button Grid.Column="3"
                                x:Name="ClearTrainingSymbolsButton"
                                Content="✖ Clear"
                                Click="ClearTrainingSymbolsButton_Click"
                                Style="{StaticResource EnhancedButtonStyle}"
                                Background="#D64545"
                                Foreground="White"
                                Width="80"
                                Margin="0,17,10,0"
                                ToolTip="Clear selected symbols and train on all"/>

                        <!-- Help Text -->
                        <TextBlock Grid.Column="4"
                                   Text="Choose symbols from saved configurations or limit the count"
                                   Foreground="#AAAAAA"
                                   FontSize="10"
                                   VerticalAlignment="Center"
                                   Margin="10,17,0,0"
                                   TextWrapping="Wrap"/>
                    </Grid>
                </Grid>
            </Border>
        </Grid>

        <!-- Top Predictions Grid -->
        <Border Grid.Row="2" Background="#23233A" BorderBrush="Cyan" BorderThickness="1" 
                CornerRadius="5" Margin="0,10,0,0" Padding="10">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>

                <!-- Header -->
                <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="0,0,0,10">
                    <TextBlock Text="📊 Top Predictions" FontSize="16" FontWeight="Bold" 
                               Foreground="Cyan" VerticalAlignment="Center"/>
                    <TextBlock x:Name="TopPredictionsCountText" Text="{Binding TopPredictionsCountText}" 
                               Foreground="#AAAAAA" FontSize="12" Margin="15,0,0,0" VerticalAlignment="Center"/>
                </StackPanel>

                <!-- DataGrid -->
                <DataGrid Grid.Row="1" x:Name="TopPredictionsGrid" 
                          ItemsSource="{Binding TopPredictions}"
                          AutoGenerateColumns="False" 
                          IsReadOnly="True"
                          Foreground="White"
                          Background="#23233A"
                          RowBackground="#23233A"
                          AlternatingRowBackground="#26264A"
                          HeadersVisibility="Column"
                          GridLinesVisibility="Horizontal"
                          HorizontalGridLinesBrush="#3E3E56"
                          BorderThickness="0"
                          CanUserReorderColumns="True"
                          CanUserResizeColumns="True"
                          CanUserSortColumns="True"
                          ColumnHeaderStyle="{StaticResource EnhancedDataGridColumnHeaderStyle}"
                          RowStyle="{StaticResource EnhancedDataGridRowStyle}"
                          CellStyle="{StaticResource EnhancedDataGridCellStyle}">
                    <DataGrid.ContextMenu>
                        <ContextMenu Background="#2D2D42" Foreground="White">
                            <MenuItem Header="Delete" Click="DeletePrediction_Click">
                                <MenuItem.Icon>
                                    <TextBlock Text="🗑️" Foreground="Red"/>
                                </MenuItem.Icon>
                            </MenuItem>
                        </ContextMenu>
                    </DataGrid.ContextMenu>
                    <DataGrid.Columns>
                        <DataGridTextColumn Header="Symbol" Binding="{Binding Symbol}" Width="80"/>
                        <DataGridTextColumn Header="Action" Binding="{Binding PredictedAction}" Width="70"/>
                        <DataGridTextColumn Header="Confidence" Binding="{Binding Confidence, StringFormat=P1}" Width="90"/>
                        <DataGridTextColumn Header="Current $" Binding="{Binding CurrentPrice, StringFormat=C2}" Width="90"/>
                        <DataGridTextColumn Header="Target $" Binding="{Binding TargetPrice, StringFormat=C2}" Width="90"/>
                        <DataGridTextColumn Header="Return" Binding="{Binding PotentialReturn, StringFormat=P2}" Width="80"/>
                        <DataGridTextColumn Header="Created" Binding="{Binding PredictionDate, StringFormat=yyyy-MM-dd HH:mm}" Width="140"/>
                        <DataGridTextColumn Header="Target Date" Binding="{Binding ExpectedFruitionDate, StringFormat=yyyy-MM-dd}" Width="100"/>
                        <DataGridTextColumn Header="Model" Binding="{Binding ModelType}" Width="80"/>
                        <DataGridTextColumn Header="Arch" Binding="{Binding ArchitectureType}" Width="70"/>
                        <DataGridTextColumn Header="Rule" Binding="{Binding TradingRule}" Width="120"/>
                    </DataGrid.Columns>
                </DataGrid>
            </Grid>
        </Border>

        <!-- Status Bar -->
        <Grid Grid.Row="3" Margin="0,5,0,0">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>

            <TextBlock Grid.Column="0" x:Name="StatusText" 
                       Text="Ready" Foreground="White" Margin="5,0"/>

            <TextBlock Grid.Column="1" x:Name="LastUpdatedText" 
                       Text="Last updated: Never" Foreground="White" Margin="0,0,5,0"/>
        </Grid>
    </Grid>
</UserControl>
