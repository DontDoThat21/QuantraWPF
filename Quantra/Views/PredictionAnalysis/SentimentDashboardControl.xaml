<UserControl x:Class="Quantra.Controls.SentimentDashboardControl"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             xmlns:lvc="clr-namespace:LiveCharts.Wpf;assembly=LiveCharts.Wpf"
             xmlns:local="clr-namespace:Quantra.Controls"
             xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
             xmlns:converters="clr-namespace:Quantra.Converters" xmlns:converters1="clr-namespace:Quantra.Converters"
             mc:Ignorable="d" 
             d:DesignHeight="600" d:DesignWidth="900"
             Background="#1E1E30">

    <UserControl.Resources>
        <ResourceDictionary>
            <ResourceDictionary.MergedDictionaries>
                <ResourceDictionary Source="/Quantra;component/Styles/EnhancedStyles.xaml" />
            </ResourceDictionary.MergedDictionaries>
            <!-- Add missing converters -->
            <converters:GreaterThanConverter x:Key="GreaterThanConverter"/>
            <converters:LessThanConverter x:Key="LessThanConverter"/>
        </ResourceDictionary>
    </UserControl.Resources>

    <Grid Margin="10">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/> <!-- Header -->
            <RowDefinition Height="*"/> <!-- Content -->
        </Grid.RowDefinitions>

        <!-- Header Section -->
        <materialDesign:Card Grid.Row="0" Style="{StaticResource EnhancedContentCardStyle}">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                
                <!-- Title -->
                <TextBlock Grid.Column="0" Text="Sentiment Analysis Dashboard" 
                           Style="{StaticResource EnhancedHeaderTextBlockStyle}"/>
                
                <!-- Symbol info -->
                <StackPanel Grid.Column="1" Orientation="Horizontal" HorizontalAlignment="Right" Margin="0,0,15,0">
                    <TextBlock Text="Symbol: " Style="{StaticResource EnhancedTextBlockStyle}" VerticalAlignment="Center"/>
                    <TextBlock x:Name="SymbolTextBlock" Text="--" Style="{StaticResource EnhancedSmallTextBlockStyle}" 
                               VerticalAlignment="Center"/>
                </StackPanel>
                
                <!-- Overall sentiment -->
                <StackPanel Grid.Column="2" Orientation="Horizontal" HorizontalAlignment="Right" Margin="0,0,15,0">
                    <TextBlock Text="Overall Sentiment: " Style="{StaticResource EnhancedTextBlockStyle}" VerticalAlignment="Center"/>
                    <TextBlock x:Name="OverallSentimentTextBlock" Text="0.00" Style="{StaticResource EnhancedSmallTextBlockStyle}" 
                               VerticalAlignment="Center"/>
                </StackPanel>
                
                <!-- Refresh button -->
                <Button Grid.Column="3" x:Name="RefreshButton" Content="â†»" Width="30" Height="30" 
                        Click="RefreshButton_Click"
                        Style="{StaticResource EnhancedButtonStyle}" ToolTip="Refresh Data"/>
            </Grid>
        </materialDesign:Card>
        
        <!-- Main Content -->
        <TabControl Grid.Row="1" Background="Transparent" BorderThickness="0">
            <!-- Historical Trends Tab -->
            <TabItem Header="Historical Trends" >
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="*"/> <!-- Main chart -->
                        <RowDefinition Height="Auto"/> <!-- Controls -->
                        <RowDefinition Height="Auto"/> <!-- Metrics and stats -->
                    </Grid.RowDefinitions>
                    
                    <!-- Main sentiment trends chart -->
                    <materialDesign:Card Grid.Row="0" Style="{StaticResource EnhancedContentCardStyle}">
                        <Grid>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="*"/>
                            </Grid.RowDefinitions>
                            
                            <Grid Grid.Row="0">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>
                                
                                <TextBlock Grid.Column="0" Text="Sentiment Historical Trends" 
                                           Style="{StaticResource EnhancedHeaderTextBlockStyle}"/>
                                
                                <StackPanel Grid.Column="1" Orientation="Horizontal" Margin="0,5,10,5">
                                    <TextBlock Text="Timeframe: " Style="{StaticResource EnhancedTextBlockStyle}" VerticalAlignment="Center"/>
                                    <ComboBox x:Name="TrendTimeframeComboBox" Width="90" SelectedIndex="1" Style="{StaticResource EnhancedComboBoxStyle}"
                                              SelectionChanged="TrendTimeframeComboBox_SelectionChanged">
                                        <ComboBoxItem Content="7 Days"/>
                                        <ComboBoxItem Content="30 Days"/>
                                        <ComboBoxItem Content="90 Days"/>
                                        <ComboBoxItem Content="1 Year"/>
                                    </ComboBox>
                                </StackPanel>
                            </Grid>
                            
                            <lvc:CartesianChart Grid.Row="1" x:Name="SentimentTrendChart" 
                                    DisableAnimations="True" 
                                    Hoverable="True"
                                    Margin="10">
                                <lvc:CartesianChart.AxisX>
                                    <lvc:Axis x:Name="SentimentTrendChartAxisX"
                                          Title="Date" 
                                          FontSize="11"
                                          Separator="{x:Static lvc:DefaultAxes.CleanSeparator}"/>
                                </lvc:CartesianChart.AxisX>
                                <lvc:CartesianChart.AxisY>
                                    <lvc:Axis x:Name="SentimentTrendChartAxisY"
                                          Title="Sentiment Score" 
                                          FontSize="11"
                                          MinValue="-1" 
                                          MaxValue="1"
                                          Separator="{x:Static lvc:DefaultAxes.CleanSeparator}"/>
                                </lvc:CartesianChart.AxisY>
                            </lvc:CartesianChart>
                        </Grid>
                    </materialDesign:Card>
                    
                    <!-- Chart controls -->
                    <materialDesign:Card Grid.Row="1" Style="{StaticResource EnhancedContentCardStyle}">
                        <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                            <TextBlock Text="Show Sources:" Style="{StaticResource EnhancedTextBlockStyle}" VerticalAlignment="Center" Margin="0,0,10,0"/>
                            <CheckBox x:Name="TwitterCheckBox" Content="Twitter" Style="{StaticResource EnhancedCheckBoxStyle}" IsChecked="True" 
                                     Checked="SourceCheckBox_Changed" Unchecked="SourceCheckBox_Changed" Margin="5,0"/>
                            <CheckBox x:Name="NewsCheckBox" Content="News" Style="{StaticResource EnhancedCheckBoxStyle}" IsChecked="True" 
                                     Checked="SourceCheckBox_Changed" Unchecked="SourceCheckBox_Changed" Margin="5,0"/>
                            <CheckBox x:Name="AnalystCheckBox" Content="Analyst" Style="{StaticResource EnhancedCheckBoxStyle}" IsChecked="True" 
                                     Checked="SourceCheckBox_Changed" Unchecked="SourceCheckBox_Changed" Margin="5,0"/>
                            <CheckBox x:Name="InsiderCheckBox" Content="Insider" Style="{StaticResource EnhancedCheckBoxStyle}" IsChecked="True" 
                                     Checked="SourceCheckBox_Changed" Unchecked="SourceCheckBox_Changed" Margin="5,0"/>
                            <CheckBox x:Name="CombinedCheckBox" Content="Combined" Style="{StaticResource EnhancedCheckBoxStyle}" IsChecked="True" 
                                     Checked="SourceCheckBox_Changed" Unchecked="SourceCheckBox_Changed" Margin="5,0"/>
                        </StackPanel>
                    </materialDesign:Card>
                    
                    <!-- Sentiment metrics -->
                    <materialDesign:Card Grid.Row="2" Style="{StaticResource EnhancedContentCardStyle}">
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>
                            
                            <!-- Lead/Lag metrics -->
                            <StackPanel Grid.Column="0">
                                <TextBlock Text="Lead/Lag Relationship" Style="{StaticResource EnhancedHeaderTextBlockStyle}"/>
                                <Grid Margin="0,5">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="Auto"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="Auto"/>
                                    </Grid.RowDefinitions>
                                    
                                    <TextBlock Grid.Row="0" Grid.Column="0" Text="Lead/Lag Days:" 
                                               Style="{StaticResource EnhancedTextBlockStyle}"/>
                                    <TextBlock Grid.Row="0" Grid.Column="1" x:Name="LeadLagDaysText" 
                                               Text="0.0 days" Style="{StaticResource EnhancedSmallTextBlockStyle}"/>
                                    
                                    <TextBlock Grid.Row="1" Grid.Column="0" Text="Relationship:" 
                                               Style="{StaticResource EnhancedTextBlockStyle}"/>
                                    <TextBlock Grid.Row="1" Grid.Column="1" x:Name="LeadLagRelationshipText" 
                                               Text="Neutral" Style="{StaticResource EnhancedSmallTextBlockStyle}"/>
                                               
                                    <TextBlock Grid.Row="2" Grid.Column="0" Text="Predictive Accuracy:" 
                                               Style="{StaticResource EnhancedTextBlockStyle}"/>
                                    <TextBlock Grid.Row="2" Grid.Column="1" x:Name="PredictiveAccuracyText" 
                                               Text="0.0%" Style="{StaticResource EnhancedSmallTextBlockStyle}"/>
                                </Grid>
                            </StackPanel>
                            
                            <!-- Source correlations -->
                            <StackPanel Grid.Column="1">
                                <TextBlock Text="Source Correlations" Style="{StaticResource EnhancedHeaderTextBlockStyle}"/>
                                <Grid Margin="0,5">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="Auto"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="Auto"/>
                                    </Grid.RowDefinitions>
                                    
                                    <TextBlock Grid.Row="0" Grid.Column="0" Text="Twitter:" 
                                               Style="{StaticResource EnhancedTextBlockStyle}"/>
                                    <TextBlock Grid.Row="0" Grid.Column="1" x:Name="TwitterCorrelationText" 
                                               Text="0.00" Style="{StaticResource EnhancedSmallTextBlockStyle}"/>
                                    
                                    <TextBlock Grid.Row="1" Grid.Column="0" Text="News:" 
                                               Style="{StaticResource EnhancedTextBlockStyle}"/>
                                    <TextBlock Grid.Row="1" Grid.Column="1" x:Name="NewsCorrelationText" 
                                               Text="0.00" Style="{StaticResource EnhancedSmallTextBlockStyle}"/>
                                               
                                    <TextBlock Grid.Row="2" Grid.Column="0" Text="Analyst:" 
                                               Style="{StaticResource EnhancedTextBlockStyle}"/>
                                    <TextBlock Grid.Row="2" Grid.Column="1" x:Name="AnalystCorrelationText" 
                                               Text="0.00" Style="{StaticResource EnhancedSmallTextBlockStyle}"/>
                                               
                                    <TextBlock Grid.Row="3" Grid.Column="0" Text="Insider:" 
                                               Style="{StaticResource EnhancedTextBlockStyle}"/>
                                    <TextBlock Grid.Row="3" Grid.Column="1" x:Name="InsiderCorrelationText" 
                                               Text="0.00" Style="{StaticResource EnhancedSmallTextBlockStyle}"/>
                                </Grid>
                            </StackPanel>
                            
                            <!-- Overall metrics -->
                            <StackPanel Grid.Column="2">
                                <TextBlock Text="Overall Metrics" Style="{StaticResource EnhancedHeaderTextBlockStyle}"/>
                                <Grid Margin="0,5">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="Auto"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="Auto"/>
                                    </Grid.RowDefinitions>
                                    
                                    <TextBlock Grid.Row="0" Grid.Column="0" Text="Overall Correlation:" 
                                               Style="{StaticResource EnhancedTextBlockStyle}"/>
                                    <TextBlock Grid.Row="0" Grid.Column="1" x:Name="OverallCorrelationText" 
                                               Text="0.00" Style="{StaticResource EnhancedSmallTextBlockStyle}"/>
                                    
                                    <TextBlock Grid.Row="1" Grid.Column="0" Text="Sentiment Trend:" 
                                               Style="{StaticResource EnhancedTextBlockStyle}"/>
                                    <TextBlock Grid.Row="1" Grid.Column="1" x:Name="SentimentTrendText" 
                                               Text="Neutral" Style="{StaticResource EnhancedSmallTextBlockStyle}"/>
                                               
                                    <TextBlock Grid.Row="2" Grid.Column="0" Text="Price Impact:" 
                                               Style="{StaticResource EnhancedTextBlockStyle}"/>
                                    <TextBlock Grid.Row="2" Grid.Column="1" x:Name="PriceImpactText" 
                                               Text="Low" Style="{StaticResource EnhancedSmallTextBlockStyle}"/>
                                </Grid>
                            </StackPanel>
                        </Grid>
                    </materialDesign:Card>
                </Grid>
            </TabItem>
            
            <!-- Analyst Ratings Tab -->
            <TabItem Header="Analyst Ratings">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/> <!-- Consensus metrics -->
                        <RowDefinition Height="*"/> <!-- Rating distribution chart -->
                        <RowDefinition Height="Auto"/> <!-- Recent ratings list -->
                    </Grid.RowDefinitions>
                    
                    <!-- Analyst consensus metrics -->
                    <materialDesign:Card Grid.Row="0" Style="{StaticResource EnhancedContentCardStyle}">
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>
                            
                            <!-- Consensus rating -->
                            <StackPanel Grid.Column="0">
                                <TextBlock Text="Consensus Rating" HorizontalAlignment="Center" 
                                           Style="{StaticResource EnhancedTextBlockStyle}"/>
                                <TextBlock x:Name="ConsensusRatingText" Text="--" HorizontalAlignment="Center"
                                           Style="{StaticResource EnhancedSmallTextBlockStyle}" Margin="0,5"/>
                            </StackPanel>
                            
                            <!-- Buy/Hold/Sell counts -->
                            <StackPanel Grid.Column="1">
                                <TextBlock Text="Rating Distribution" HorizontalAlignment="Center" 
                                           Style="{StaticResource EnhancedTextBlockStyle}"/>
                                <StackPanel Orientation="Horizontal" HorizontalAlignment="Center" Margin="0,5">
                                    <TextBlock x:Name="BuyCountText" Text="0" Style="{StaticResource EnhancedTextBlockStyle}"/>
                                    <TextBlock Text=" Buy / " Style="{StaticResource EnhancedTextBlockStyle}"/>
                                    <TextBlock x:Name="HoldCountText" Text="0" Style="{StaticResource EnhancedTextBlockStyle}"/>
                                    <TextBlock Text=" Hold / " Style="{StaticResource EnhancedTextBlockStyle}"/>
                                    <TextBlock x:Name="SellCountText" Text="0" Style="{StaticResource EnhancedTextBlockStyle}"/>
                                    <TextBlock Text=" Sell" Style="{StaticResource EnhancedTextBlockStyle}"/>
                                </StackPanel>
                            </StackPanel>
                            
                            <!-- Average price target -->
                            <StackPanel Grid.Column="2">
                                <TextBlock Text="Average Price Target" HorizontalAlignment="Center" 
                                           Style="{StaticResource EnhancedTextBlockStyle}"/>
                                <StackPanel Orientation="Horizontal" HorizontalAlignment="Center" Margin="0,5">
                                    <TextBlock x:Name="AvgPriceTargetText" Text="$0.00" 
                                               Style="{StaticResource EnhancedSmallTextBlockStyle}"/>
                                    <TextBlock x:Name="TargetPctChangeText" Text=" (0.0%)" 
                                               Style="{StaticResource EnhancedSmallTextBlockStyle}" Margin="3,0,0,0"/>
                                </StackPanel>
                            </StackPanel>
                            
                            <!-- Price target range -->
                            <StackPanel Grid.Column="3">
                                <TextBlock Text="Price Target Range" HorizontalAlignment="Center" 
                                           Style="{StaticResource EnhancedTextBlockStyle}"/>
                                <TextBlock x:Name="PriceTargetRangeText" Text="$0.00 - $0.00" 
                                           HorizontalAlignment="Center"
                                           Style="{StaticResource EnhancedTextBlockStyle}" Margin="0,5"/>
                            </StackPanel>
                        </Grid>
                    </materialDesign:Card>
                    
                    <!-- Rating distribution chart -->
                    <materialDesign:Card Grid.Row="1" Style="{StaticResource EnhancedContentCardStyle}">
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="3*"/>
                                <ColumnDefinition Width="2*"/>
                            </Grid.ColumnDefinitions>
                            
                            <!-- Rating distribution chart -->
                            <Grid Grid.Column="0">
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="*"/>
                                </Grid.RowDefinitions>
                                
                                <TextBlock Grid.Row="0" Text="Rating Distribution" 
                                           Style="{StaticResource EnhancedHeaderTextBlockStyle}"/>
                                           
                                <lvc:CartesianChart Grid.Row="1" x:Name="RatingDistributionChart" 
                                                DisableAnimations="True" Margin="10">
                                    <lvc:CartesianChart.AxisX>
                                        <lvc:Axis Title="Rating" 
                                              FontSize="11"
                                              x:Name="RatingDistributionChartAxisX"/>
                                    </lvc:CartesianChart.AxisX>
                                    <lvc:CartesianChart.AxisY>
                                        <lvc:Axis Title="Count" 
                                              FontSize="11"
                                              MinValue="0"
                                              x:Name="RatingDistributionChartAxisY"/>
                                    </lvc:CartesianChart.AxisY>
                                </lvc:CartesianChart>
                            </Grid>
                            
                            <!-- Price target chart -->
                            <Grid Grid.Column="1">
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="*"/>
                                </Grid.RowDefinitions>
                                
                                <TextBlock Grid.Row="0" Text="Price Target Trend" 
                                           Style="{StaticResource EnhancedHeaderTextBlockStyle}"/>
                                           
                                <lvc:CartesianChart Grid.Row="1" x:Name="PriceTargetTrendChart" 
                                                DisableAnimations="True" Margin="10">
                                    <lvc:CartesianChart.AxisX>
                                        <lvc:Axis Title="Date" 
                                              FontSize="11"
                                              x:Name="PriceTargetTrendChartAxisX"/>
                                    </lvc:CartesianChart.AxisX>
                                    <lvc:CartesianChart.AxisY>
                                        <lvc:Axis Title="Price Target" 
                                              FontSize="11"
                                              MinValue="0"
                                              x:Name="PriceTargetTrendChartAxisY"/>
                                    </lvc:CartesianChart.AxisY>
                                </lvc:CartesianChart>
                            </Grid>
                        </Grid>
                    </materialDesign:Card>
                    
                    <!-- Recent ratings list -->
                    <materialDesign:Card Grid.Row="2" Style="{StaticResource EnhancedContentCardStyle}">
                        <Grid>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="*"/>
                            </Grid.RowDefinitions>
                            
                            <TextBlock Grid.Row="0" Text="Recent Analyst Ratings" 
                                       Style="{StaticResource EnhancedHeaderTextBlockStyle}"/>
                            
                            <ListView Grid.Row="1" x:Name="AnalystRatingListView" 
                                      Background="Transparent" BorderThickness="0" 
                                      Height="150" Margin="10,0,10,5">
                                <ListView.View>
                                    <GridView>
                                        <GridViewColumn Header="Date" Width="80">
                                            <GridViewColumn.CellTemplate>
                                                <DataTemplate>
                                                    <TextBlock Text="{Binding RatingDate, StringFormat={}{0:MM/dd/yyyy}}" 
                                                               Style="{StaticResource EnhancedTextBlockStyle}"/>
                                                </DataTemplate>
                                            </GridViewColumn.CellTemplate>
                                        </GridViewColumn>
                                        <GridViewColumn Header="Analyst" Width="120">
                                            <GridViewColumn.CellTemplate>
                                                <DataTemplate>
                                                    <TextBlock Text="{Binding AnalystName}" 
                                                               Style="{StaticResource EnhancedTextBlockStyle}"/>
                                                </DataTemplate>
                                            </GridViewColumn.CellTemplate>
                                        </GridViewColumn>
                                        <GridViewColumn Header="Rating" Width="100">
                                            <GridViewColumn.CellTemplate>
                                                <DataTemplate>
                                                    <TextBlock Text="{Binding Rating}">
                                                        <TextBlock.Style>
                                                            <Style TargetType="TextBlock" BasedOn="{StaticResource EnhancedTextBlockStyle}">
                                                                <Setter Property="Foreground" Value="White"/>
                                                                <Style.Triggers>
                                                                    <DataTrigger Binding="{Binding SentimentScore}" Value="0.8">
                                                                        <Setter Property="Foreground" Value="#20C040"/>
                                                                    </DataTrigger>
                                                                    <DataTrigger Binding="{Binding SentimentScore}" Value="0.5">
                                                                        <Setter Property="Foreground" Value="#80C080"/>
                                                                    </DataTrigger>
                                                                    <DataTrigger Binding="{Binding SentimentScore}" Value="-0.5">
                                                                        <Setter Property="Foreground" Value="#C08080"/>
                                                                    </DataTrigger>
                                                                    <DataTrigger Binding="{Binding SentimentScore}" Value="-0.8">
                                                                        <Setter Property="Foreground" Value="#C02020"/>
                                                                    </DataTrigger>
                                                                </Style.Triggers>
                                                            </Style>
                                                        </TextBlock.Style>
                                                    </TextBlock>
                                                </DataTemplate>
                                            </GridViewColumn.CellTemplate>
                                        </GridViewColumn>
                                        <GridViewColumn Header="Change" Width="100">
                                            <GridViewColumn.CellTemplate>
                                                <DataTemplate>
                                                    <TextBlock>
                                                        <TextBlock.Text>
                                                            <MultiBinding StringFormat="{}{0}">
                                                                <Binding Path="ChangeType"/>
                                                            </MultiBinding>
                                                        </TextBlock.Text>
                                                        <TextBlock.Style>
                                                            <Style TargetType="TextBlock">
                                                                <Setter Property="Foreground" Value="White"/>
                                                                <Style.Triggers>
                                                                    <DataTrigger Binding="{Binding ChangeType}" Value="Upgrade">
                                                                        <Setter Property="Foreground" Value="#20C040"/>
                                                                    </DataTrigger>
                                                                    <DataTrigger Binding="{Binding ChangeType}" Value="Downgrade">
                                                                        <Setter Property="Foreground" Value="#C02020"/>
                                                                    </DataTrigger>
                                                                </Style.Triggers>
                                                            </Style>
                                                        </TextBlock.Style>
                                                    </TextBlock>
                                                </DataTemplate>
                                            </GridViewColumn.CellTemplate>
                                        </GridViewColumn>
                                        <GridViewColumn Header="Price Target" Width="100">
                                            <GridViewColumn.CellTemplate>
                                                <DataTemplate>
                                                    <TextBlock Text="{Binding PriceTarget, StringFormat=\${0:F2}}" 
                                                               Style="{StaticResource EnhancedTextBlockStyle}"/>
                                                </DataTemplate>
                                            </GridViewColumn.CellTemplate>
                                        </GridViewColumn>
                                        <GridViewColumn Header="PT Change" Width="100">
                                            <GridViewColumn.CellTemplate>
                                                <DataTemplate>
                                                    <TextBlock>
                                                        <TextBlock.Text>
                                                            <MultiBinding StringFormat="{}{0:P1}">
                                                                <Binding Path="PriceTargetChangePercent"/>
                                                            </MultiBinding>
                                                        </TextBlock.Text>
                                                        <TextBlock.Style>
                                                            <Style TargetType="TextBlock">
                                                                <Setter Property="Foreground" Value="White"/>
                                                                <Style.Triggers>
                                                                    <DataTrigger Binding="{Binding PriceTargetChangePercent, Converter={StaticResource GreaterThanConverter}, ConverterParameter=0}" Value="True">
                                                                        <Setter Property="Foreground" Value="#20C040"/>
                                                                    </DataTrigger>
                                                                    <DataTrigger Binding="{Binding PriceTargetChangePercent, Converter={StaticResource LessThanConverter}, ConverterParameter=0}" Value="True">
                                                                        <Setter Property="Foreground" Value="#C02020"/>
                                                                    </DataTrigger>
                                                                </Style.Triggers>
                                                            </Style>
                                                        </TextBlock.Style>
                                                    </TextBlock>
                                                </DataTemplate>
                                            </GridViewColumn.CellTemplate>
                                        </GridViewColumn>
                                    </GridView>
                                </ListView.View>
                            </ListView>
                        </Grid>
                    </materialDesign:Card>
                </Grid>
            </TabItem>
            
            <!-- Insider Trading Tab -->
            <TabItem Header="Insider Trading" >
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/> <!-- Metrics -->
                        <RowDefinition Height="*"/> <!-- Activity chart -->
                        <RowDefinition Height="Auto"/> <!-- Recent transactions -->
                    </Grid.RowDefinitions>
                    
                    <!-- Insider metrics -->
                    <materialDesign:Card Grid.Row="0" Style="{StaticResource EnhancedContentCardStyle}" Padding="10">
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>
                            
                            <!-- Buy/sell ratio -->
                            <StackPanel Grid.Column="0">
                                <TextBlock Text="Buy/Sell Ratio" HorizontalAlignment="Center" 
                                           Style="{StaticResource EnhancedTextBlockStyle}" FontSize="14"/>
                                <TextBlock x:Name="BuySellRatioText" Text="0.0" HorizontalAlignment="Center"
                                           Foreground="Cyan" FontSize="18" FontWeight="Bold" Margin="0,5"/>
                            </StackPanel>
                            
                            <!-- Net insider value -->
                            <StackPanel Grid.Column="1">
                                <TextBlock Text="Net Insider Value" HorizontalAlignment="Center" 
                                           Style="{StaticResource EnhancedTextBlockStyle}" FontSize="14"/>
                                <TextBlock x:Name="NetInsiderValueText" Text="$0" HorizontalAlignment="Center"
                                           Foreground="Cyan" FontSize="18" FontWeight="Bold" Margin="0,5"/>
                            </StackPanel>
                            
                            <!-- CEO activity -->
                            <StackPanel Grid.Column="2">
                                <TextBlock Text="CEO Activity" HorizontalAlignment="Center" 
                                           Style="{StaticResource EnhancedTextBlockStyle}" FontSize="14"/>
                                <TextBlock x:Name="CEOActivityText" Text="Neutral" HorizontalAlignment="Center"
                                           Style="{StaticResource EnhancedTextBlockStyle}" FontSize="18" FontWeight="Bold" Margin="0,5"/>
                            </StackPanel>
                            
                            <!-- Notable figures -->
                            <StackPanel Grid.Column="3">
                                <TextBlock Text="Notable Figure Activity" HorizontalAlignment="Center" 
                                           Style="{StaticResource EnhancedTextBlockStyle}" FontSize="14"/>
                                <TextBlock x:Name="NotableFigureActivityText" Text="None" HorizontalAlignment="Center"
                                           Style="{StaticResource EnhancedTextBlockStyle}" FontSize="18" FontWeight="Bold" Margin="0,5"/>
                            </StackPanel>
                        </Grid>
                    </materialDesign:Card>
                    
                    <!-- Insider activity chart -->
                    <materialDesign:Card Grid.Row="1" Style="{StaticResource EnhancedContentCardStyle}">
                        <Grid>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="*"/>
                            </Grid.RowDefinitions>
                            
                            <Grid Grid.Row="0">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>
                                
                                <TextBlock Grid.Column="0" Text="Insider Trading Activity" 
                                          Style="{StaticResource EnhancedHeaderTextBlockStyle}"/>
                                
                                <StackPanel Grid.Column="1" Orientation="Horizontal" Margin="0,5,10,5">
                                    <TextBlock Text="View: " Style="{StaticResource EnhancedTextBlockStyle}" VerticalAlignment="Center"/>
                                    <ComboBox x:Name="InsiderViewComboBox" Width="120" SelectedIndex="0" Style="{StaticResource EnhancedComboBoxStyle}"
                                              SelectionChanged="InsiderViewComboBox_SelectionChanged">
                                        <ComboBoxItem Content="Transaction Value"/>
                                        <ComboBoxItem Content="Transaction Count"/>
                                        <ComboBoxItem Content="Buy/Sell Balance"/>
                                        <ComboBoxItem Content="Sentiment Impact"/>
                                    </ComboBox>
                                </StackPanel>
                            </Grid>
                            
                            <lvc:CartesianChart Grid.Row="1" x:Name="InsiderActivityChart" 
                                               DisableAnimations="True" 
                                               Margin="10">
                                <lvc:CartesianChart.AxisX>
                                    <lvc:Axis Title="Date" 
                                             FontSize="11"
                                             x:Name="InsiderActivityChartAxisX"/>
                                </lvc:CartesianChart.AxisX>
                                <lvc:CartesianChart.AxisY>
                                    <lvc:Axis Title="Value" 
                                             FontSize="11"
                                             x:Name="InsiderActivityChartAxisY"/>
                                </lvc:CartesianChart.AxisY>
                            </lvc:CartesianChart>
                        </Grid>
                    </materialDesign:Card>
                    
                    <!-- Recent insider transactions -->
                    <materialDesign:Card Grid.Row="2" Style="{StaticResource EnhancedContentCardStyle}">
                        <Grid>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="*"/>
                            </Grid.RowDefinitions>
                            
                            <TextBlock Grid.Row="0" Text="Recent Insider Transactions" 
                                      Style="{StaticResource EnhancedHeaderTextBlockStyle}"/>
                            
                            <ListView Grid.Row="1" x:Name="InsiderTransactionListView" 
                                     Background="Transparent" BorderThickness="0" 
                                     Height="150" Margin="10,0,10,5">
                                <ListView.View>
                                    <GridView>
                                        <GridViewColumn Header="Date" Width="80">
                                            <GridViewColumn.CellTemplate>
                                                <DataTemplate>
                                                    <TextBlock Text="{Binding TransactionDate, StringFormat={}{0:MM/dd/yyyy}}" 
                                                              Style="{StaticResource EnhancedTextBlockStyle}"/>
                                                </DataTemplate>
                                            </GridViewColumn.CellTemplate>
                                        </GridViewColumn>
                                        <GridViewColumn Header="Insider" Width="120">
                                            <GridViewColumn.CellTemplate>
                                                <DataTemplate>
                                                    <TextBlock Text="{Binding InsiderName}" 
                                                              Style="{StaticResource EnhancedTextBlockStyle}"/>
                                                </DataTemplate>
                                            </GridViewColumn.CellTemplate>
                                        </GridViewColumn>
                                        <GridViewColumn Header="Title" Width="100">
                                            <GridViewColumn.CellTemplate>
                                                <DataTemplate>
                                                    <TextBlock Text="{Binding InsiderTitle}" 
                                                              Style="{StaticResource EnhancedTextBlockStyle}"/>
                                                </DataTemplate>
                                            </GridViewColumn.CellTemplate>
                                        </GridViewColumn>
                                        <GridViewColumn Header="Action" Width="100">
                                            <GridViewColumn.CellTemplate>
                                                <DataTemplate>
                                                    <TextBlock Text="{Binding TransactionType}">
                                                        <TextBlock.Style>
                                                            <Style TargetType="TextBlock" BasedOn="{StaticResource EnhancedTextBlockStyle}">
                                                                <Setter Property="Foreground" Value="White"/>
                                                                <Style.Triggers>
                                                                    <DataTrigger Binding="{Binding TransactionType}" Value="Purchase">
                                                                        <Setter Property="Foreground" Value="#20C040"/>
                                                                    </DataTrigger>
                                                                    <DataTrigger Binding="{Binding TransactionType}" Value="Sale">
                                                                        <Setter Property="Foreground" Value="#C02020"/>
                                                                    </DataTrigger>
                                                                </Style.Triggers>
                                                            </Style>
                                                        </TextBlock.Style>
                                                    </TextBlock>
                                                </DataTemplate>
                                            </GridViewColumn.CellTemplate>
                                        </GridViewColumn>
                                        <GridViewColumn Header="Shares" Width="80">
                                            <GridViewColumn.CellTemplate>
                                                <DataTemplate>
                                                    <TextBlock Text="{Binding Quantity, StringFormat=N0}" 
                                                              Style="{StaticResource EnhancedTextBlockStyle}"/>
                                                </DataTemplate>
                                            </GridViewColumn.CellTemplate>
                                        </GridViewColumn>
                                        <GridViewColumn Header="Price" Width="80">
                                            <GridViewColumn.CellTemplate>
                                                <DataTemplate>
                                                    <TextBlock Text="{Binding Price, StringFormat=\${0:F2}}" 
                                                              Style="{StaticResource EnhancedTextBlockStyle}"/>
                                                </DataTemplate>
                                            </GridViewColumn.CellTemplate>
                                        </GridViewColumn>
                                        <GridViewColumn Header="Value" Width="100">
                                            <GridViewColumn.CellTemplate>
                                                <DataTemplate>
                                                    <TextBlock Text="{Binding Value, StringFormat=\${0:N0}}" 
                                                              Style="{StaticResource EnhancedTextBlockStyle}"/>
                                                </DataTemplate>
                                            </GridViewColumn.CellTemplate>
                                        </GridViewColumn>
                                        <GridViewColumn Header="Notable" Width="60">
                                            <GridViewColumn.CellTemplate>
                                                <DataTemplate>
                                                    <TextBlock Text="{Binding IsNotableFigure}" 
                                                              Style="{StaticResource EnhancedTextBlockStyle}"/>
                                                </DataTemplate>
                                            </GridViewColumn.CellTemplate>
                                        </GridViewColumn>
                                    </GridView>
                                </ListView.View>
                            </ListView>
                        </Grid>
                    </materialDesign:Card>
                </Grid>
            </TabItem>
            
            <!-- News &amp; Sentiment Shifts Tab -->
            <TabItem Header="News &amp; Sentiment Shifts" >
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="*"/> <!-- Sentiment shift events chart -->
                        <RowDefinition Height="Auto"/> <!-- News sentiment -->
                    </Grid.RowDefinitions>
                    
                    <!-- Sentiment shift events chart -->
                    <materialDesign:Card Grid.Row="0" Style="{StaticResource EnhancedContentCardStyle}">
                        <Grid>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="*"/>
                            </Grid.RowDefinitions>
                            
                            <TextBlock Grid.Row="0" Text="Sentiment Shift Events" 
                                      Style="{StaticResource EnhancedHeaderTextBlockStyle}"/>
                            
                            <lvc:CartesianChart Grid.Row="1" x:Name="SentimentShiftChart" 
                                               DisableAnimations="True" 
                                               Margin="10">
                                <lvc:CartesianChart.AxisX>
                                    <lvc:Axis Title="Date" 
                                             FontSize="11"
                                             x:Name="SentimentShiftChartAxisX"/>
                                </lvc:CartesianChart.AxisX>
                                <lvc:CartesianChart.AxisY>
                                    <lvc:Axis Title="Sentiment" 
                                             FontSize="11"
                                             MinValue="-1"
                                             MaxValue="1"
                                             x:Name="SentimentShiftChartAxisY"/>
                                </lvc:CartesianChart.AxisY>
                            </lvc:CartesianChart>
                        </Grid>
                    </materialDesign:Card>
                    
                    <!-- News sentiment list -->
                    <materialDesign:Card Grid.Row="1" Style="{StaticResource EnhancedContentCardStyle}">
                        <Grid>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="*"/>
                            </Grid.RowDefinitions>
                            
                            <Grid Grid.Row="0">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>
                                
                                <TextBlock Grid.Column="0" Text="Significant Sentiment Shifts" 
                                          Style="{StaticResource EnhancedHeaderTextBlockStyle}"/>
                                
                                <StackPanel Grid.Column="1" Orientation="Horizontal" Margin="0,5,10,5">
                                    <TextBlock Text="Filter: " Style="{StaticResource EnhancedTextBlockStyle}" VerticalAlignment="Center"/>
                                    <ComboBox x:Name="ShiftFilterComboBox" Width="120" SelectedIndex="0" Style="{StaticResource EnhancedComboBoxStyle}"
                                             SelectionChanged="ShiftFilterComboBox_SelectionChanged">
                                        <ComboBoxItem Content="All Sources"/>
                                        <ComboBoxItem Content="News Only"/>
                                        <ComboBoxItem Content="Social Media Only"/>
                                        <ComboBoxItem Content="Analyst Only"/>
                                        <ComboBoxItem Content="Insider Only"/>
                                    </ComboBox>
                                </StackPanel>
                            </Grid>
                            
                            <ListView Grid.Row="1" x:Name="SentimentShiftListView" 
                                     Background="Transparent" BorderThickness="0" 
                                     Height="200" Margin="10,0,10,5">
                                <ListView.View>
                                    <GridView>
                                        <GridViewColumn Header="Date" Width="80">
                                            <GridViewColumn.CellTemplate>
                                                <DataTemplate>
                                                    <TextBlock Text="{Binding Date, StringFormat={}{0:MM/dd/yyyy}}" 
                                                              Style="{StaticResource EnhancedTextBlockStyle}"/>
                                                </DataTemplate>
                                            </GridViewColumn.CellTemplate>
                                        </GridViewColumn>
                                        <GridViewColumn Header="Source" Width="100">
                                            <GridViewColumn.CellTemplate>
                                                <DataTemplate>
                                                    <TextBlock Text="{Binding Source}" 
                                                              Style="{StaticResource EnhancedTextBlockStyle}"/>
                                                </DataTemplate>
                                            </GridViewColumn.CellTemplate>
                                        </GridViewColumn>
                                        <GridViewColumn Header="Shift Direction" Width="120">
                                            <GridViewColumn.CellTemplate>
                                                <DataTemplate>
                                                    <TextBlock>
                                                        <TextBlock.Text>
                                                            <MultiBinding StringFormat="{}{0} ({1:F2})">
                                                                <Binding Path="Direction"/>
                                                                <Binding Path="SentimentShift"/>
                                                            </MultiBinding>
                                                        </TextBlock.Text>
                                                        <TextBlock.Style>
                                                            <Style TargetType="TextBlock">
                                                                <Style.Triggers>
                                                                    <DataTrigger Binding="{Binding SentimentShift, Converter={StaticResource GreaterThanConverter}, ConverterParameter=0}" Value="True">
                                                                        <Setter Property="Foreground" Value="#20C040"/>
                                                                    </DataTrigger>
                                                                    <DataTrigger Binding="{Binding SentimentShift, Converter={StaticResource LessThanConverter}, ConverterParameter=0}" Value="True">
                                                                        <Setter Property="Foreground" Value="#C02020"/>
                                                                    </DataTrigger>
                                                                </Style.Triggers>
                                                            </Style>
                                                        </TextBlock.Style>
                                                    </TextBlock>
                                                </DataTemplate>
                                            </GridViewColumn.CellTemplate>
                                        </GridViewColumn>
                                        <GridViewColumn Header="Price Impact" Width="100">
                                            <GridViewColumn.CellTemplate>
                                                <DataTemplate>
                                                    <TextBlock Text="{Binding SubsequentPriceChange, StringFormat={}{0:F2}%}">
                                                        <TextBlock.Style>
                                                            <Style TargetType="TextBlock" BasedOn="{StaticResource EnhancedTextBlockStyle}">
                                                                <Style.Triggers>
                                                                    <DataTrigger Binding="{Binding SubsequentPriceChange, Converter={StaticResource GreaterThanConverter}, ConverterParameter=0}" Value="True">
                                                                        <Setter Property="Foreground" Value="#20C040"/>
                                                                    </DataTrigger>
                                                                    <DataTrigger Binding="{Binding SubsequentPriceChange, Converter={StaticResource LessThanConverter}, ConverterParameter=0}" Value="True">
                                                                        <Setter Property="Foreground" Value="#C02020"/>
                                                                    </DataTrigger>
                                                                </Style.Triggers>
                                                            </Style>
                                                        </TextBlock.Style>
                                                    </TextBlock>
                                                </DataTemplate>
                                            </GridViewColumn.CellTemplate>
                                        </GridViewColumn>
                                        <GridViewColumn Header="Predictive" Width="80">
                                            <GridViewColumn.CellTemplate>
                                                <DataTemplate>
                                                    <CheckBox IsChecked="{Binding PriceFollowedSentiment}" 
                                                             IsEnabled="False"
                                                             HorizontalAlignment="Center"/>
                                                </DataTemplate>
                                            </GridViewColumn.CellTemplate>
                                        </GridViewColumn>
                                        <GridViewColumn Header="Notes" Width="200">
                                            <GridViewColumn.CellTemplate>
                                                <DataTemplate>
                                                    <TextBlock Text="{Binding Notes}" 
                                                              Style="{StaticResource EnhancedTextBlockStyle}"
                                                              TextWrapping="Wrap"
                                                              MaxWidth="200"/>
                                                </DataTemplate>
                                            </GridViewColumn.CellTemplate>
                                        </GridViewColumn>
                                    </GridView>
                                </ListView.View>
                            </ListView>
                        </Grid>
                    </materialDesign:Card>
                </Grid>
            </TabItem>
        </TabControl>
    </Grid>
</UserControl>