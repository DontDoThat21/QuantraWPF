<Window x:Class="Quantra.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml" 
        xmlns:local="clr-namespace:Quantra"
        Title="Trading Dashboard" Height="800" Width="1200" WindowStartupLocation="CenterScreen"
        Background="Transparent" WindowStyle="None" AllowsTransparency="True"
        MinHeight="600" MinWidth="800" ResizeMode="CanResize">
    <Grid>
        <!-- Resize borders -->
        <local:ResizableBorder/>
        
        <Border Background="{StaticResource DarkBlueBrush}" CornerRadius="10" Margin="4">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>

                <!-- CustomTitleBar with Settings Button -->
                <local:SharedTitleBar x:Name="TitleBar" Grid.Row="0" Title="Trading Dashboard"/>

                <!-- Emergency Stop Banner -->
                <Grid x:Name="EmergencyStopBanner" Grid.Row="0" Grid.RowSpan="2" Visibility="Collapsed" Panel.ZIndex="100">
                    <Border Background="#80800000" VerticalAlignment="Top" Height="40">
                        <Grid>
                            <TextBlock Text="EMERGENCY STOP ACTIVE - ALL TRADING HALTED" 
                                      FontWeight="Bold" Foreground="White" 
                                      HorizontalAlignment="Center" VerticalAlignment="Center"/>
                            <Button Content="Resume Trading" Width="120" Height="28" 
                                    Style="{StaticResource EnhancedButtonStyle}"
                                    VerticalAlignment="Center" HorizontalAlignment="Right" Margin="0,0,10,0"
                                    Click="ResumeTrading_Click"/>
                        </Grid>
                    </Border>
                </Grid>

                <TabControl x:Name="MainTabControl" Grid.Row="1" Grid.ColumnSpan="2" Margin="10" 
                           AllowDrop="True"
                           Drop="MainTabControl_Drop"
                           PreviewMouseMove="MainTabControl_PreviewMouseMove"
                           SelectionChanged="MainTabControl_SelectionChanged">
                    <!-- The tabs will be loaded dynamically from the database -->
                    <TabItem Header="+" MouseLeftButtonUp="AddNewTabButton_Click">
                        <Grid>
                            <Border>
                                <Button Content="Add Tool" Width="200" Height="100" HorizontalAlignment="Center" VerticalAlignment="Center" Click="AddControlButton_Click" Style="{StaticResource EnhancedButtonStyle}"/>
                            </Border>
                        </Grid>
                    </TabItem>
                </TabControl>

                <!-- Modal Dialog -->
                <Grid x:Name="ModalDialog" Background="#80000000" Visibility="Collapsed">
                    <Border Background="White" Padding="20" CornerRadius="10" HorizontalAlignment="Center" VerticalAlignment="Center">
                        <StackPanel>
                            <TextBlock Text="Confirm API Call" FontSize="18" FontWeight="Bold" Margin="0,0,0,10"/>
                            <TextBlock Text="Do you want to proceed with the API call?" Margin="0,0,0,20"/>
                            <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                                <Button Content="Yes" Width="75" Margin="5" Click="ConfirmApiCall_Click" Style="{StaticResource EnhancedButtonStyle}"/>
                                <Button Content="No" Width="75" Margin="5" Click="CancelApiCall_Click" Style="{StaticResource EnhancedButtonStyle}"/>
                            </StackPanel>
                        </StackPanel>
                    </Border>
                </Grid>
            </Grid>
        </Border>

        <!-- Resize grips -->
        <Rectangle Name="BottomRightResizeGrip" 
                   HorizontalAlignment="Right" 
                   VerticalAlignment="Bottom" 
                   Width="20" 
                   Height="20" 
                   Fill="Transparent" 
                   Cursor="SizeNWSE" 
                   MouseDown="ResizeGrip_MouseDown" />
        <Rectangle Name="BottomLeftResizeGrip" 
                   HorizontalAlignment="Left" 
                   VerticalAlignment="Bottom" 
                   Width="20" 
                   Height="20" 
                   Fill="Transparent" 
                   Cursor="SizeNESW" 
                   MouseDown="ResizeGrip_MouseDown" />
        <Rectangle Name="TopRightResizeGrip" 
                   HorizontalAlignment="Right" 
                   VerticalAlignment="Top" 
                   Width="20" 
                   Height="20" 
                   Fill="Transparent" 
                   Cursor="SizeNESW" 
                   MouseDown="ResizeGrip_MouseDown" />
        <Rectangle Name="TopLeftResizeGrip" 
                   HorizontalAlignment="Left" 
                   VerticalAlignment="Top" 
                   Width="20" 
                   Height="20" 
                   Fill="Transparent" 
                   Cursor="SizeNWSE" 
                   MouseDown="ResizeGrip_MouseDown" />
    </Grid>
</Window>