<UserControl x:Class="Quantra.Views.Intelligence.InsiderTransactionsControl"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             xmlns:local="clr-namespace:Quantra.Views.Intelligence"
             xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
             mc:Ignorable="d" 
             d:DesignHeight="600" d:DesignWidth="900"
             Background="#1E1E30"
             MinWidth="400" MinHeight="300">
    
    <UserControl.Resources>
        <ResourceDictionary>
            <ResourceDictionary.MergedDictionaries>
                <ResourceDictionary Source="/Styles/EnhancedStyles.xaml"/>
            </ResourceDictionary.MergedDictionaries>
            
            <!-- Transaction Type Color Converter -->
            <local:TransactionTypeColorConverter x:Key="TransactionTypeColorConverter"/>
            <local:BoolToVisibilityConverter x:Key="BoolToVisibilityConverter"/>
        </ResourceDictionary>
    </UserControl.Resources>
    
    <Grid Margin="10">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>
        
        <!-- Header -->
        <Grid Grid.Row="0" Margin="0,0,0,10">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>
            
            <TextBlock Grid.Column="0" Text="Insider Transactions" FontSize="22" 
                       FontWeight="Bold" Foreground="White" VerticalAlignment="Center"/>
            
            <StackPanel Grid.Column="1" Orientation="Horizontal">
                <CheckBox x:Name="LoadAllSymbolsCheckBox" Content="Load All Symbols" 
                          Foreground="#AAAAAA" VerticalAlignment="Center"
                          Margin="0,0,10,0" Checked="LoadAllSymbolsCheckBox_Changed"
                          Unchecked="LoadAllSymbolsCheckBox_Changed"
                          Style="{StaticResource EnhancedCheckBoxStyle}"/>
                <TextBox x:Name="SymbolTextBox" Width="100" Height="30" 
                         Margin="0,0,10,0" VerticalContentAlignment="Center"
                         materialDesign:HintAssist.Hint="Symbol"
                         Style="{StaticResource EnhancedTextBoxStyle}"
                         KeyDown="SymbolTextBox_KeyDown"/>
                <Button x:Name="LoadButton" Content="Load" Width="80" Height="30" 
                        Click="LoadButton_Click"
                        Background="#3E3E56" Foreground="White" BorderBrush="Cyan"/>
            </StackPanel>
        </Grid>
        
        <!-- Filter Panel -->
        <Border Grid.Row="1" Background="#262638" CornerRadius="5" 
                Padding="10" Margin="0,0,0,10">
            <StackPanel Orientation="Horizontal">
                <TextBlock Text="Filter by Type:" Foreground="#AAAAAA" 
                           VerticalAlignment="Center" Margin="0,0,10,0"/>
                <ComboBox x:Name="TransactionTypeFilter" Width="150" Height="28" 
                          Style="{StaticResource EnhancedComboBoxStyle}"
                          SelectionChanged="TransactionTypeFilter_SelectionChanged">
                    <ComboBoxItem Content="All Transactions" IsSelected="True"/>
                    <ComboBoxItem Content="Purchases"/>
                    <ComboBoxItem Content="Sales"/>
                    <ComboBoxItem Content="Option Exercises"/>
                    <ComboBoxItem Content="Awards/Grants"/>
                </ComboBox>
                
                <TextBlock Text="Date Range:" Foreground="#AAAAAA" 
                           VerticalAlignment="Center" Margin="20,0,10,0"/>
                <DatePicker x:Name="StartDatePicker" Width="120" Height="28" 
                            Margin="0,0,5,0" SelectedDateChanged="DateFilter_Changed"/>
                <TextBlock Text="to" Foreground="#AAAAAA" 
                           VerticalAlignment="Center" Margin="5,0"/>
                <DatePicker x:Name="EndDatePicker" Width="120" Height="28" 
                            Margin="5,0,0,0" SelectedDateChanged="DateFilter_Changed"/>
                
                <Button x:Name="ClearFilterButton" Content="Clear" Width="60" Height="28" 
                        Margin="10,0,0,0" Click="ClearFilterButton_Click"
                        Background="#3E3E56" Foreground="#AAAAAA" BorderBrush="#555555"/>
            </StackPanel>
        </Border>
        
        <!-- Loading Indicator -->
        <ProgressBar Grid.Row="2" x:Name="LoadingIndicator" IsIndeterminate="True" 
                     Height="4" Margin="0,0,0,10"
                     Visibility="Collapsed" Foreground="Cyan"/>
        
        <!-- Transactions DataGrid -->
        <DataGrid Grid.Row="3" x:Name="TransactionsGrid" 
                  AutoGenerateColumns="False"
                  Background="#2D2D42" Foreground="White"
                  BorderBrush="#3E3E56" BorderThickness="1"
                  RowBackground="#2D2D42"
                  AlternatingRowBackground="#262638"
                  GridLinesVisibility="Horizontal"
                  HorizontalGridLinesBrush="#3E3E56"
                  CanUserAddRows="False"
                  IsReadOnly="True"
                  SelectionMode="Single"
                  ColumnHeaderStyle="{StaticResource EnhancedDataGridColumnHeaderStyle}">
            <DataGrid.Columns>
                <DataGridTextColumn Header="Symbol" Binding="{Binding Symbol}" Width="80">
                    <DataGridTextColumn.ElementStyle>
                        <Style TargetType="TextBlock">
                            <Setter Property="Foreground" Value="Cyan"/>
                            <Setter Property="FontWeight" Value="Bold"/>
                            <Setter Property="VerticalAlignment" Value="Center"/>
                        </Style>
                    </DataGridTextColumn.ElementStyle>
                </DataGridTextColumn>
                
                <DataGridTextColumn Header="Filing Date" Binding="{Binding FilingDate, StringFormat='{}{0:MM/dd/yyyy}'}" Width="100">
                    <DataGridTextColumn.ElementStyle>
                        <Style TargetType="TextBlock">
                            <Setter Property="Foreground" Value="#99CCFF"/>
                            <Setter Property="VerticalAlignment" Value="Center"/>
                        </Style>
                    </DataGridTextColumn.ElementStyle>
                </DataGridTextColumn>
                
                <DataGridTextColumn Header="Trans. Date" Binding="{Binding TransactionDate, StringFormat='{}{0:MM/dd/yyyy}'}" Width="100">
                    <DataGridTextColumn.ElementStyle>
                        <Style TargetType="TextBlock">
                            <Setter Property="Foreground" Value="#AAAAAA"/>
                            <Setter Property="VerticalAlignment" Value="Center"/>
                        </Style>
                    </DataGridTextColumn.ElementStyle>
                </DataGridTextColumn>
                
                <DataGridTextColumn Header="Insider Name" Binding="{Binding OwnerName}" Width="150">
                    <DataGridTextColumn.ElementStyle>
                        <Style TargetType="TextBlock">
                            <Setter Property="Foreground" Value="White"/>
                            <Setter Property="FontWeight" Value="SemiBold"/>
                            <Setter Property="VerticalAlignment" Value="Center"/>
                            <Setter Property="TextTrimming" Value="CharacterEllipsis"/>
                        </Style>
                    </DataGridTextColumn.ElementStyle>
                </DataGridTextColumn>
                
                <DataGridTextColumn Header="Title" Binding="{Binding OwnerTitle}" Width="120">
                    <DataGridTextColumn.ElementStyle>
                        <Style TargetType="TextBlock">
                            <Setter Property="Foreground" Value="#AAAAAA"/>
                            <Setter Property="VerticalAlignment" Value="Center"/>
                            <Setter Property="TextTrimming" Value="CharacterEllipsis"/>
                        </Style>
                    </DataGridTextColumn.ElementStyle>
                </DataGridTextColumn>
                
                <DataGridTemplateColumn Header="Type" Width="90">
                    <DataGridTemplateColumn.CellTemplate>
                        <DataTemplate>
                            <Border CornerRadius="3" Padding="5,2" HorizontalAlignment="Left"
                                    Background="{Binding TransactionCode, Converter={StaticResource TransactionTypeColorConverter}}">
                                <TextBlock Text="{Binding TransactionTypeDescription}" 
                                           Foreground="White" FontSize="11" FontWeight="SemiBold"/>
                            </Border>
                        </DataTemplate>
                    </DataGridTemplateColumn.CellTemplate>
                </DataGridTemplateColumn>
                
                <DataGridTextColumn Header="Shares" Binding="{Binding SharesTraded, StringFormat=\{0:N0\}}" Width="90">
                    <DataGridTextColumn.ElementStyle>
                        <Style TargetType="TextBlock">
                            <Setter Property="Foreground" Value="White"/>
                            <Setter Property="VerticalAlignment" Value="Center"/>
                            <Setter Property="HorizontalAlignment" Value="Right"/>
                        </Style>
                    </DataGridTextColumn.ElementStyle>
                </DataGridTextColumn>
                
                <DataGridTextColumn Header="Price" Binding="{Binding PricePerShare, StringFormat=\$\{0:F2\}}" Width="80">
                    <DataGridTextColumn.ElementStyle>
                        <Style TargetType="TextBlock">
                            <Setter Property="Foreground" Value="White"/>
                            <Setter Property="VerticalAlignment" Value="Center"/>
                            <Setter Property="HorizontalAlignment" Value="Right"/>
                        </Style>
                    </DataGridTextColumn.ElementStyle>
                </DataGridTextColumn>
                
                <DataGridTextColumn Header="Total Value" Binding="{Binding TotalValue, StringFormat=\$\{0:N0\}}" Width="110">
                    <DataGridTextColumn.ElementStyle>
                        <Style TargetType="TextBlock">
                            <Setter Property="Foreground" Value="Cyan"/>
                            <Setter Property="FontWeight" Value="SemiBold"/>
                            <Setter Property="VerticalAlignment" Value="Center"/>
                            <Setter Property="HorizontalAlignment" Value="Right"/>
                        </Style>
                    </DataGridTextColumn.ElementStyle>
                </DataGridTextColumn>
                
                <DataGridTextColumn Header="Shares After" Binding="{Binding SharesOwnedFollowing, StringFormat=\{0:N0\}}" Width="100">
                    <DataGridTextColumn.ElementStyle>
                        <Style TargetType="TextBlock">
                            <Setter Property="Foreground" Value="#AAAAAA"/>
                            <Setter Property="VerticalAlignment" Value="Center"/>
                            <Setter Property="HorizontalAlignment" Value="Right"/>
                        </Style>
                    </DataGridTextColumn.ElementStyle>
                </DataGridTextColumn>
            </DataGrid.Columns>
        </DataGrid>
        
        <!-- Status Bar -->
        <Grid Grid.Row="4" Margin="0,10,0,0">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>
            
            <TextBlock Grid.Column="0" x:Name="StatusText" 
                       Text="Enter a stock symbol to load insider transactions." 
                       Foreground="#AAAAAA"/>
            
            <StackPanel Grid.Column="1" Orientation="Horizontal">
                <TextBlock x:Name="TotalBuysText" Foreground="#50E070" Margin="0,0,15,0"/>
                <TextBlock x:Name="TotalSellsText" Foreground="#FF6B6B"/>
            </StackPanel>
        </Grid>
    </Grid>
</UserControl>
