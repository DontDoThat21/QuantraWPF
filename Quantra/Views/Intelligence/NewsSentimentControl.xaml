<UserControl x:Class="Quantra.Views.Intelligence.NewsSentimentControl"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             xmlns:local="clr-namespace:Quantra.Views.Intelligence"
             xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
             mc:Ignorable="d" 
             d:DesignHeight="600" d:DesignWidth="800"
             Background="#1E1E30"
             MinWidth="400" MinHeight="300">
    
    <UserControl.Resources>
        <ResourceDictionary>
            <ResourceDictionary.MergedDictionaries>
                <ResourceDictionary Source="/Styles/EnhancedStyles.xaml"/>
            </ResourceDictionary.MergedDictionaries>
            
            <!-- Sentiment Color Converter -->
            <local:SentimentColorConverter x:Key="SentimentColorConverter"/>
            <local:SentimentLabelConverter x:Key="SentimentLabelConverter"/>
        </ResourceDictionary>
    </UserControl.Resources>
    
    <Grid Margin="10">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>
        
        <!-- Header -->
        <Grid Grid.Row="0" Margin="0,0,0,10">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>
            
            <TextBlock Grid.Column="0" Text="News Sentiment Analysis" FontSize="22" 
                       FontWeight="Bold" Foreground="White" VerticalAlignment="Center"/>
            
            <StackPanel Grid.Column="1" Orientation="Horizontal">
                <TextBox x:Name="TickerTextBox" Width="100" Height="30" 
                         Margin="0,0,10,0" VerticalContentAlignment="Center"
                         materialDesign:HintAssist.Hint="Ticker(s)"
                         Style="{StaticResource EnhancedTextBoxStyle}"
                         KeyDown="TickerTextBox_KeyDown"
                         ToolTip="Enter one or more stock symbols separated by commas (e.g., AAPL,MSFT). Leave empty to search by topic only."/>
                <ComboBox x:Name="TopicComboBox" Width="160" Height="30" 
                          Margin="0,0,10,0"
                          Style="{StaticResource EnhancedComboBoxStyle}"
                          SelectionChanged="TopicComboBox_SelectionChanged"
                          ToolTip="Select a topic to filter news articles. Clear ticker to search by topic only.">
                    <ComboBoxItem Content="All Topics" IsSelected="True" Tag="{x:Null}"/>
                    <ComboBoxItem Content="Blockchain" Tag="blockchain"/>
                    <ComboBoxItem Content="Earnings" Tag="earnings"/>
                    <ComboBoxItem Content="IPO" Tag="ipo"/>
                    <ComboBoxItem Content="Mergers &amp; Acquisitions" Tag="mergers_and_acquisitions"/>
                    <ComboBoxItem Content="Financial Markets" Tag="financial_markets"/>
                    <ComboBoxItem Content="Economy - Fiscal" Tag="economy_fiscal"/>
                    <ComboBoxItem Content="Economy - Monetary" Tag="economy_monetary"/>
                    <ComboBoxItem Content="Economy - Macro" Tag="economy_macro"/>
                    <ComboBoxItem Content="Energy &amp; Transportation" Tag="energy_transportation"/>
                    <ComboBoxItem Content="Finance" Tag="finance"/>
                    <ComboBoxItem Content="Life Sciences" Tag="life_sciences"/>
                    <ComboBoxItem Content="Manufacturing" Tag="manufacturing"/>
                    <ComboBoxItem Content="Real Estate" Tag="real_estate"/>
                    <ComboBoxItem Content="Retail &amp; Wholesale" Tag="retail_wholesale"/>
                    <ComboBoxItem Content="Technology" Tag="technology"/>
                </ComboBox>
                <Button x:Name="LoadButton" Content="Load" Width="80" Height="30" 
                        Click="LoadButton_Click"
                        Background="#3E3E56" Foreground="White" BorderBrush="Cyan"/>
            </StackPanel>
        </Grid>
        
        <!-- Loading Indicator -->
        <ProgressBar Grid.Row="1" x:Name="LoadingIndicator" IsIndeterminate="True" 
                     Height="4" Margin="0,0,0,10"
                     Visibility="Collapsed" Foreground="Cyan"/>
        
        <!-- Summary Panel -->
        <Border Grid.Row="2" x:Name="SummaryPanel" Background="#2D4A3D" CornerRadius="5" 
                Padding="15" Margin="0,0,0,15" Visibility="Collapsed">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                
                <StackPanel Grid.Column="0">
                    <TextBlock Text="MARKET SENTIMENT OVERVIEW" FontWeight="Bold" Foreground="#1E90FF" FontSize="12"/>
                    <StackPanel Orientation="Horizontal" Margin="0,5,0,0">
                        <TextBlock Text="Total Articles: " Foreground="#99CCFF"/>
                        <TextBlock x:Name="TotalArticlesText" Text="0" Foreground="#50E070" FontWeight="SemiBold"/>
                    </StackPanel>
                </StackPanel>
                
                <StackPanel Grid.Column="1" Margin="20,0">
                    <TextBlock Text="Bullish" Foreground="#99CCFF" FontSize="11" HorizontalAlignment="Center"/>
                    <TextBlock x:Name="BullishCountText" Text="0" Foreground="#50E070" 
                               FontSize="18" FontWeight="Bold" HorizontalAlignment="Center"/>
                </StackPanel>
                
                <StackPanel Grid.Column="2" Margin="20,0">
                    <TextBlock Text="Neutral" Foreground="#99CCFF" FontSize="11" HorizontalAlignment="Center"/>
                    <TextBlock x:Name="NeutralCountText" Text="0" Foreground="#FFCC00" 
                               FontSize="18" FontWeight="Bold" HorizontalAlignment="Center"/>
                </StackPanel>
                
                <StackPanel Grid.Column="3" Margin="20,0,0,0">
                    <TextBlock Text="Bearish" Foreground="#99CCFF" FontSize="11" HorizontalAlignment="Center"/>
                    <TextBlock x:Name="BearishCountText" Text="0" Foreground="#FF6B6B" 
                               FontSize="18" FontWeight="Bold" HorizontalAlignment="Center"/>
                </StackPanel>
            </Grid>
        </Border>
        
        <!-- News List -->
        <ListView Grid.Row="3" x:Name="NewsListView" 
                  Background="#2D2D42" BorderBrush="#3E3E56" BorderThickness="1"
                  ScrollViewer.VerticalScrollBarVisibility="Auto"
                  ScrollViewer.HorizontalScrollBarVisibility="Disabled">
            <ListView.ItemContainerStyle>
                <Style TargetType="ListViewItem">
                    <Setter Property="Background" Value="Transparent"/>
                    <Setter Property="Foreground" Value="White"/>
                    <Setter Property="Padding" Value="5"/>
                    <Setter Property="Margin" Value="0,2"/>
                    <Setter Property="HorizontalContentAlignment" Value="Stretch"/>
                    <Setter Property="Template">
                        <Setter.Value>
                            <ControlTemplate TargetType="ListViewItem">
                                <Border x:Name="Bd" Background="{TemplateBinding Background}" 
                                        BorderBrush="#3E3E56" BorderThickness="0,0,0,1" 
                                        Padding="{TemplateBinding Padding}">
                                    <ContentPresenter/>
                                </Border>
                                <ControlTemplate.Triggers>
                                    <Trigger Property="IsMouseOver" Value="True">
                                        <Setter TargetName="Bd" Property="Background" Value="#3E3E56"/>
                                    </Trigger>
                                    <Trigger Property="IsSelected" Value="True">
                                        <Setter TargetName="Bd" Property="Background" Value="#4A4A66"/>
                                    </Trigger>
                                </ControlTemplate.Triggers>
                            </ControlTemplate>
                        </Setter.Value>
                    </Setter>
                </Style>
            </ListView.ItemContainerStyle>
            <ListView.ItemTemplate>
                <DataTemplate>
                    <Grid Margin="5">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="80"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>
                        
                        <!-- Sentiment Badge -->
                        <Border Grid.Column="0" CornerRadius="5" Padding="8,4" 
                                HorizontalAlignment="Left" VerticalAlignment="Top"
                                Background="{Binding OverallSentimentLabel, Converter={StaticResource SentimentColorConverter}}">
                            <StackPanel>
                                <TextBlock Text="{Binding OverallSentimentLabel, Converter={StaticResource SentimentLabelConverter}}" 
                                           Foreground="White" FontWeight="Bold" FontSize="10" 
                                           HorizontalAlignment="Center"/>
                                <TextBlock Text="{Binding OverallSentimentScore, StringFormat='{}{0:F2}'}" 
                                           Foreground="White" FontSize="9" 
                                           HorizontalAlignment="Center"/>
                            </StackPanel>
                        </Border>
                        
                        <!-- News Content -->
                        <StackPanel Grid.Column="1" Margin="10,0,0,0">
                            <!-- Header with Source and Time -->
                            <StackPanel Orientation="Horizontal" Margin="0,0,0,3">
                                <TextBlock Text="{Binding Source}" Foreground="#1E90FF" FontSize="11"/>
                                <TextBlock Text=" • " Foreground="#666666"/>
                                <TextBlock Text="{Binding TimeAgo}" Foreground="#888888" FontSize="11"/>
                            </StackPanel>
                            
                            <!-- Title -->
                            <TextBlock Text="{Binding Title}" Foreground="White" FontSize="13" 
                                       FontWeight="SemiBold" TextWrapping="Wrap" Margin="0,0,0,5"/>
                            
                            <!-- Summary -->
                            <TextBlock Text="{Binding Summary}" Foreground="#AAAAAA" FontSize="11" 
                                       TextWrapping="Wrap" MaxHeight="40" TextTrimming="CharacterEllipsis"/>
                            
                            <!-- Read More Link -->
                            <TextBlock Margin="0,5,0,0">
                                <Hyperlink x:Name="ArticleLink" NavigateUri="{Binding Url}" 
                                           RequestNavigate="Hyperlink_RequestNavigate"
                                           Foreground="Cyan" TextDecorations="None">
                                    Read full article →
                                </Hyperlink>
                            </TextBlock>
                        </StackPanel>
                    </Grid>
                </DataTemplate>
            </ListView.ItemTemplate>
        </ListView>
        
        <!-- Status Bar -->
        <TextBlock Grid.Row="4" x:Name="StatusText" Text="Enter ticker(s) and/or select a topic to load news sentiment." 
                   Foreground="#AAAAAA" Margin="0,10,0,0"/>
    </Grid>
</UserControl>
